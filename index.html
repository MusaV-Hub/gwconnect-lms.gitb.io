<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GWConnect LMS - Graduate World Connect</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a4d3a 0%, #2d5a3d 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #1a4d3a, #2d5a3d);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ffd700;
            font-size: 24px;
            font-weight: bold;
        }

        .logo-text h1 {
            color: #2d3748;
            font-size: 28px;
            font-weight: 700;
        }

        .logo-text p {
            color: #718096;
            font-size: 14px;
        }

        .user-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .profile-section {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .profile-picture {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #ffd700;
            cursor: pointer;
        }

        .profile-placeholder {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #1a4d3a, #2d5a3d);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ffd700;
            font-weight: bold;
            cursor: pointer;
            border: 2px solid #ffd700;
        }

        .role-toggle, .logout-btn {
            background: #4ade80;
            color: #1a4d3a;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .logout-btn {
            background: #6b7280;
            color: white;
        }

        .role-toggle:hover {
            background: #22c55e;
            transform: translateY(-2px);
        }

        .logout-btn:hover {
            background: #4b5563;
            transform: translateY(-2px);
        }

        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            min-height: 600px;
        }

        /* Authentication Styles */
        .auth-container {
            max-width: 400px;
            margin: 100px auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            border-radius: 8px;
            overflow: hidden;
            background: #f7fafc;
        }

        .auth-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            background: transparent;
        }

        .auth-tab.active {
            background: #1a4d3a;
            color: #ffd700;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3748;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #4ade80;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            cursor: pointer;
            background: #f7fafc;
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            width: 100%;
        }

        .file-input-wrapper:hover {
            border-color: #4ade80;
            background: #f0fff4;
        }

        .file-input-wrapper input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .btn {
            background: #1a4d3a;
            color: #ffd700;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            width: 100%;
        }

        .btn:hover {
            background: #2d5a3d;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
            width: auto;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .btn-success {
            background: #4ade80;
            color: #1a4d3a;
        }

        .btn-success:hover {
            background: #22c55e;
        }

        .btn-danger {
            background: #e53e3e;
            color: white;
        }

        .btn-danger:hover {
            background: #c53030;
        }

        .btn-warning {
            background: #ffd700;
            color: #1a4d3a;
        }

        .btn-warning:hover {
            background: #f59e0b;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
            width: auto;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
            border-radius: 12px;
            padding: 25px;
            border-left: 5px solid #ffd700;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .dashboard-card h3 {
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 20px;
        }

        .dashboard-card p {
            color: #718096;
            margin-bottom: 15px;
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: #1a4d3a;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #718096;
            font-size: 14px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ade80, #22c55e);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .course-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .course-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .course-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-color: #ffd700;
        }

        .course-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .course-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .course-title {
            font-size: 20px;
            font-weight: 600;
            color: #2d3748;
        }

        .course-modules {
            margin: 20px 0;
        }

        .module-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .module-item:hover {
            background: #f7fafc;
        }

        .module-status {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: white;
        }

        .status-completed { background: #4ade80; }
        .status-in-progress { background: #ffd700; color: #1a4d3a; }
        .status-pending { background: #d1d5db; }

        /* Admin Dashboard Specific Styles */
        .admin-tabs {
            display: flex;
            margin-bottom: 30px;
            border-radius: 8px;
            overflow: hidden;
            background: #f7fafc;
            border: 1px solid #e2e8f0;
        }

        .admin-tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            background: transparent;
            font-weight: 600;
            border-right: 1px solid #e2e8f0;
        }

        .admin-tab:last-child {
            border-right: none;
        }

        .admin-tab.active {
            background: #1a4d3a;
            color: #ffd700;
        }

        .admin-tab:hover:not(.active) {
            background: #f0fff4;
        }

        .admin-content {
            min-height: 500px;
        }

        .quick-actions {
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .quick-actions h3 {
            margin-bottom: 15px;
            color: #2d3748;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .learner-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .learner-table th,
        .learner-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .learner-table th {
            background: #f7fafc;
            font-weight: 600;
            color: #2d3748;
        }

        .learner-table tr:hover {
            background: #f9fafb;
        }

        .certificate-preview {
            background: linear-gradient(135deg, #1a4d3a 0%, #2d5a3d 100%);
            color: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }

        .certificate-preview::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.1) 0%, transparent 70%);
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
        }

        .certificate-content {
            position: relative;
            z-index: 1;
        }

        .certificate-border {
            border: 3px solid #ffd700;
            border-radius: 10px;
            padding: 20px;
            margin: 10px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 900px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #718096;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .search-filter {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 200px;
        }

        .filter-select {
            min-width: 150px;
        }

        .hidden {
            display: none;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1001;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: #4ade80;
        }

        .notification.error {
            background: #e53e3e;
        }

        .notification.info {
            background: #3b82f6;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .dashboard-grid,
            .course-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                padding: 20px;
            }

            .admin-tabs {
                flex-direction: column;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }

            .search-filter {
                flex-direction: column;
                align-items: stretch;
            }

            .learner-table {
                font-size: 14px;
            }

            .learner-table th,
            .learner-table td {
                padding: 8px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }

            .main-content {
                padding: 20px;
            }

            .dashboard-card {
                padding: 20px;
            }

            .stat-number {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Authentication Screen -->
        <div id="authScreen">
            <div class="auth-container">
                <div class="auth-header">
                    <div class="logo">
                        <div class="logo-icon">GW</div>
                        <div class="logo-text">
                            <h1>GWConnect LMS</h1>
                            <p>Graduate World Connect</p>
                        </div>
                    </div>
                </div>

                <div class="auth-tabs">
                    <button class="auth-tab active" onclick="switchAuthTab('login')">Login</button>
                    <button class="auth-tab" onclick="switchAuthTab('register')">Register</button>
                </div>

                <!-- Login Form -->
                <div id="loginForm">
                    <form onsubmit="handleLogin(event)">
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="loginEmail" required placeholder="Enter your email">
                        </div>
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="loginPassword" required placeholder="Enter your password">
                        </div>
                        <div class="form-group">
                            <label>Role</label>
                            <select id="loginRole" required>
                                <option value="">Select your role</option>
                                <option value="intern">Intern</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                        <button type="submit" class="btn">Login</button>
                    </form>
                    <p style="margin-top: 15px; text-align: center; color: #718096; font-size: 14px;">
                        Demo Admin: admin@gwc.com / admin123
                    </p>
                </div>

                <!-- Register Form -->
                <div id="registerForm" class="hidden">
                    <form onsubmit="handleRegister(event)">
                        <div class="form-group">
                            <label>Full Name</label>
                            <input type="text" id="registerName" required placeholder="Enter your full name">
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="registerEmail" required placeholder="Enter your email">
                        </div>
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="registerPassword" required placeholder="Create a password">
                        </div>
                        <div class="form-group">
                            <label>Confirm Password</label>
                            <input type="password" id="confirmPassword" required placeholder="Confirm your password">
                        </div>
                        <div class="form-group">
                            <label>Role</label>
                            <select id="registerRole" required>
                                <option value="">Select your role</option>
                                <option value="intern">Intern</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Department</label>
                            <select id="registerDepartment">
                                <option value="">Select your department</option>
                                <option value="Information Technology">Information Technology</option>
                                <option value="Human Resources">Human Resources</option>
                                <option value="Finance & Accounting">Finance & Accounting</option>
                                <option value="Marketing & Communications">Marketing & Communications</option>
                                <option value="Operations & Logistics">Operations & Logistics</option>
                                <option value="Sales & Business Development">Sales & Business Development</option>
                                <option value="Customer Service">Customer Service</option>
                                <option value="Research & Development">Research & Development</option>
                                <option value="Quality Assurance">Quality Assurance</option>
                                <option value="Legal & Compliance">Legal & Compliance</option>
                                <option value="Administration">Administration</option>
                                <option value="Project Management">Project Management</option>
                                <option value="Training & Development">Training & Development</option>
                                <option value="Procurement">Procurement</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Profile Picture (Optional)</label>
                            <div class="file-input-wrapper">
                                <input type="file" id="registerProfilePic" accept="image/*" onchange="previewProfilePicture(this, 'registerPreview')">
                                <div id="registerPreview">
                                    📷 Click to upload profile picture
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="btn">Register</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Main Application -->
        <div id="mainApp" class="hidden">
            <header class="header">
                <div class="logo">
                    <div class="logo-icon">GW</div>
                    <div class="logo-text">
                        <h1>GWConnect LMS</h1>
                        <p>Graduate World Connect Learning Management System</p>
                    </div>
                </div>
                <div class="user-controls">
                    <div class="profile-section">
                        <div id="userProfilePic" class="profile-placeholder" onclick="openProfileModal()">
                            👤
                        </div>
                        <span id="currentUser">Loading...</span>
                    </div>
                    <button class="role-toggle" id="roleToggle" onclick="toggleRole()">Switch Role</button>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>
            </header>

            <main class="main-content">
                <!-- Intern Dashboard -->
                <div id="internDashboard">
                    <h2 style="margin-bottom: 25px; color: #2d3748; font-size: 28px;">Welcome to Your Learning Journey</h2>
                    
                    <div class="dashboard-grid">
                        <div class="dashboard-card">
                            <h3>📊 Overall Progress</h3>
                            <p>Complete your Management Assistant training</p>
                            <div class="progress-bar">
                                <div class="progress-fill" id="overallProgress" style="width: 0%"></div>
                            </div>
                            <small id="progressText">0% Complete • 0 of 0 components finished</small>
                        </div>
                        
                        <div class="dashboard-card">
                            <h3>🎯 Current Focus</h3>
                            <p id="currentFocus">Management Assistant Course</p>
                            <div class="progress-bar">
                                <div class="progress-fill" id="currentProgress" style="width: 0%"></div>
                            </div>
                            <small id="currentProgressText">Start your learning journey</small>
                        </div>
                        
                        <div class="dashboard-card">
                            <h3>📋 Logbook Evidence</h3>
                            <p>Documents ready for download</p>
                            <button class="btn btn-success" onclick="downloadLogbook()">Download Evidence</button>
                        </div>
                    </div>

                    <div class="course-grid" id="internCourseGrid">
                        <!-- Courses will be loaded here -->
                    </div>
                </div>

                <!-- Admin Dashboard -->
                <div id="adminDashboard" class="hidden">
                    <h2 style="margin-bottom: 25px; color: #2d3748; font-size: 28px;">Admin Dashboard</h2>
                    
                    <div class="dashboard-grid">
                        <div class="dashboard-card">
                            <div class="stat-number" id="totalLearners">0</div>
                            <div class="stat-label">Active Learners</div>
                        </div>
                        <div class="dashboard-card">
                            <div class="stat-number" id="totalCourses">1</div>
                            <div class="stat-label">Courses Available</div>
                        </div>
                        <div class="dashboard-card">
                            <div class="stat-number" id="avgCompletion">0%</div>
                            <div class="stat-label">Average Completion</div>
                        </div>
                        <div class="dashboard-card">
                            <div class="stat-number" id="totalCertificates">0</div>
                            <div class="stat-label">Certificates Issued</div>
                        </div>
                    </div>

                    <div class="admin-tabs">
                        <button class="admin-tab active" onclick="switchAdminTab('overview')">📊 Overview</button>
                        <button class="admin-tab" onclick="switchAdminTab('courses')">📚 Courses</button>
                        <button class="admin-tab" onclick="switchAdminTab('learners')">👥 Learners</button>
                        <button class="admin-tab" onclick="switchAdminTab('certificates')">🏆 Certificates</button>
                        <button class="admin-tab" onclick="switchAdminTab('reports')">📈 Reports</button>
                    </div>

                    <div class="admin-content">
                        <!-- Overview Tab -->
                        <div id="overviewTab" class="admin-tab-content">
                            <div class="quick-actions">
                                <h3>Quick Actions</h3>
                                <div class="action-buttons">
                                    <button class="btn btn-success btn-small" onclick="openCreateCourseModal()">➕ Create Course</button>
                                    <button class="btn btn-secondary btn-small" onclick="openImportLearnersModal()">📥 Import Learners</button>
                                    <button class="btn btn-warning btn-small" onclick="exportAllReports()">📊 Export All Reports</button>
                                    <button class="btn btn-secondary btn-small" onclick="viewSystemSettings()">⚙️ System Settings</button>
                                </div>
                            </div>

                            <div class="certificate-preview">
                                <div class="certificate-content">
                                    <div class="certificate-border">
                                        <h1 style="margin-bottom: 20px; font-size: 32px;">🏆 Certificate of Completion</h1>
                                        <p style="font-size: 18px; margin-bottom: 20px;">This is to certify that</p>
                                        <h2 style="margin-bottom: 20px; font-size: 28px; color: #ffd700;">Sample Student Name</h2>
                                        <p style="font-size: 18px; margin-bottom: 20px;">has successfully completed the</p>
                                        <h3 style="margin-bottom: 30px; font-size: 24px;">Management Assistant Course</h3>
                                        <div style="display: flex; justify-content: space-between; margin-top: 40px;">
                                            <div>
                                                <p style="border-top: 2px solid #ffd700; padding-top: 10px;">Date: January 2024</p>
                                            </div>
                                            <div>
                                                <p style="border-top: 2px solid #ffd700; padding-top: 10px;">Graduate World Connect</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Courses Tab -->
                        <div id="coursesTab" class="admin-tab-content hidden">
                            <div class="quick-actions">
                                <h3>Course Management</h3>
                                <div class="action-buttons">
                                    <button class="btn btn-success btn-small" onclick="openCreateCourseModal()">➕ Create New Course</button>
                                    <button class="btn btn-secondary btn-small" onclick="duplicateCourse()">📋 Duplicate Course</button>
                                    <button class="btn btn-warning btn-small" onclick="exportCourseTemplates()">📤 Export Templates</button>
                                </div>
                            </div>
                            <div id="adminCourseGrid" class="course-grid">
                                <!-- Admin course management will be loaded here -->
                            </div>
                        </div>

                        <!-- Learners Tab -->
                        <div id="learnersTab" class="admin-tab-content hidden">
                            <div class="quick-actions">
                                <h3>Learner Management</h3>
                                <div class="action-buttons">
                                    <button class="btn btn-success btn-small" onclick="openAddLearnerModal()">➕ Add Learner</button>
                                    <button class="btn btn-secondary btn-small" onclick="openImportLearnersModal()">📥 Import Learners</button>
                                    <button class="btn btn-warning btn-small" onclick="exportLearnerData()">📤 Export Data</button>
                                    <button class="btn btn-secondary btn-small" onclick="sendBulkNotifications()">📧 Send Notifications</button>
                                </div>
                            </div>
                            
                            <div class="search-filter">
                                <input type="text" class="search-input" placeholder="Search learners..." onkeyup="filterLearners(this.value)">
                                <select class="filter-select" onchange="filterLearnersByDepartment(this.value)">
                                    <option value="">All Departments</option>
                                    <option value="Information Technology">Information Technology</option>
                                    <option value="Human Resources">Human Resources</option>
                                    <option value="Finance & Accounting">Finance & Accounting</option>
                                    <option value="Marketing & Communications">Marketing & Communications</option>
                                    <option value="Operations & Logistics">Operations & Logistics</option>
                                    <option value="Sales & Business Development">Sales & Business Development</option>
                                    <option value="Customer Service">Customer Service</option>
                                    <option value="Research & Development">Research & Development</option>
                                    <option value="Quality Assurance">Quality Assurance</option>
                                    <option value="Legal & Compliance">Legal & Compliance</option>
                                    <option value="Administration">Administration</option>
                                    <option value="Project Management">Project Management</option>
                                    <option value="Training & Development">Training & Development</option>
                                    <option value="Procurement">Procurement</option>
                                    <option value="Other">Other</option>
                                </select>
                                <select class="filter-select" onchange="filterLearnersByProgress(this.value)">
                                    <option value="">All Progress</option>
                                    <option value="0-25">0-25%</option>
                                    <option value="26-50">26-50%</option>
                                    <option value="51-75">51-75%</option>
                                    <option value="76-100">76-100%</option>
                                </select>
                            </div>

                            <div style="overflow-x: auto;">
                                <table class="learner-table" id="learnerTable">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Email</th>
                                            <th>Department</th>
                                            <th>Progress</th>
                                            <th>Certificates</th>
                                            <th>Last Active</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="learnerTableBody">
                                        <!-- Learner data will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Certificates Tab -->
                        <div id="certificatesTab" class="admin-tab-content hidden">
                            <div class="quick-actions">
                                <h3>Certificate Management</h3>
                                <div class="action-buttons">
                                    <button class="btn btn-success btn-small" onclick="generateBulkCertificates()">🏆 Generate Bulk Certificates</button>
                                    <button class="btn btn-secondary btn-small" onclick="customizeCertificateTemplate()">🎨 Customize Template</button>
                                    <button class="btn btn-warning btn-small" onclick="exportCertificateData()">📤 Export Certificate Data</button>
                                    <button class="btn btn-secondary btn-small" onclick="verifyCertificates()">✅ Verify Certificates</button>
                                </div>
                            </div>
                            <div id="certificatesList">
                                <!-- Certificate list will be loaded here -->
                            </div>
                        </div>

                        <!-- Reports Tab -->
                        <div id="reportsTab" class="admin-tab-content hidden">
                            <div class="quick-actions">
                                <h3>Reports & Analytics</h3>
                                <div class="action-buttons">
                                    <button class="btn btn-success btn-small" onclick="generateProgressReport()">📊 Progress Report</button>
                                    <button class="btn btn-secondary btn-small" onclick="generateEngagementReport()">📈 Engagement Report</button>
                                    <button class="btn btn-warning btn-small" onclick="generateCompletionReport()">🎯 Completion Report</button>
                                    <button class="btn btn-secondary btn-small" onclick="generateCustomReport()">📋 Custom Report</button>
                                </div>
                            </div>
                            <div id="reportsContent">
                                <!-- Reports content will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>👤 Profile Settings</h2>
                <button class="close-btn" onclick="closeModal('profileModal')">&times;</button>
            </div>
            <form onsubmit="updateProfile(event)">
                <div class="form-group">
                    <label>Profile Picture</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="profilePicInput" accept="image/*" onchange="previewProfilePicture(this, 'profilePreview')">
                        <div id="profilePreview">
                            📷 Click to upload new profile picture
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" id="profileName" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="profileEmail" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Department</label>
                    <select id="profileDepartment">
                        <option value="">Select your department</option>
                        <option value="Information Technology">Information Technology</option>
                        <option value="Human Resources">Human Resources</option>
                        <option value="Finance & Accounting">Finance & Accounting</option>
                        <option value="Marketing & Communications">Marketing & Communications</option>
                        <option value="Operations & Logistics">Operations & Logistics</option>
                        <option value="Sales & Business Development">Sales & Business Development</option>
                        <option value="Customer Service">Customer Service</option>
                        <option value="Research & Development">Research & Development</option>
                        <option value="Quality Assurance">Quality Assurance</option>
                        <option value="Legal & Compliance">Legal & Compliance</option>
                        <option value="Administration">Administration</option>
                        <option value="Project Management">Project Management</option>
                        <option value="Training & Development">Training & Development</option>
                        <option value="Procurement">Procurement</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <button type="submit" class="btn">Update Profile</button>
            </form>
        </div>
    </div>

    <!-- Create Course Modal -->
    <div id="createCourseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>➕ Create New Course</h2>
                <button class="close-btn" onclick="closeModal('createCourseModal')">&times;</button>
            </div>
            <form onsubmit="createCourse(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>Course Title</label>
                        <input type="text" id="courseTitle" required placeholder="Enter course title">
                    </div>
                    <div class="form-group">
                        <label>Course Icon</label>
                        <select id="courseIcon" required>
                            <option value="">Select an icon</option>
                            <option value="💼">💼 Business</option>
                            <option value="📧">📧 Communication</option>
                            <option value="📅">📅 Management</option>
                            <option value="📁">📁 Administration</option>
                            <option value="💻">💻 Technology</option>
                            <option value="📊">📊 Analytics</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Course Description</label>
                    <textarea id="courseDescription" rows="3" required placeholder="Enter course description"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Category</label>
                        <select id="courseCategory" required>
                            <option value="">Select category</option>
                            <option value="professional-development">Professional Development</option>
                            <option value="technical-skills">Technical Skills</option>
                            <option value="soft-skills">Soft Skills</option>
                            <option value="compliance">Compliance</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Duration (hours)</label>
                        <input type="number" id="courseDuration" min="1" placeholder="Estimated hours">
                    </div>
                </div>
                <button type="submit" class="btn">Create Course</button>
            </form>
        </div>
    </div>

    <!-- Import Learners Modal -->
    <div id="importLearnersModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>📥 Import Learners</h2>
                <button class="close-btn" onclick="closeModal('importLearnersModal')">&times;</button>
            </div>
            <div class="form-group">
                <label>Upload CSV File</label>
                <div class="file-input-wrapper">
                    <input type="file" id="importFile" accept=".csv" onchange="previewImportFile(this)">
                    <div id="importPreview">
                        📄 Click to upload CSV file<br>
                        <small>Format: Name, Email, Department, Role</small>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label>Or Add Manually</label>
                <textarea id="manualImport" rows="6" placeholder="Enter learner data (one per line):&#10;John Doe, john@example.com, IT, intern&#10;Jane Smith, jane@example.com, HR, intern"></textarea>
            </div>
            <button class="btn" onclick="importLearners()">Import Learners</button>
        </div>
    </div>

    <!-- Add Learner Modal -->
    <div id="addLearnerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>➕ Add New Learner</h2>
                <button class="close-btn" onclick="closeModal('addLearnerModal')">&times;</button>
            </div>
            <form onsubmit="addLearner(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" id="learnerName" required placeholder="Enter full name">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="learnerEmail" required placeholder="Enter email address">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Department</label>
                        <select id="learnerDepartment">
                            <option value="">Select department</option>
                            <option value="Information Technology">Information Technology</option>
                            <option value="Human Resources">Human Resources</option>
                            <option value="Finance & Accounting">Finance & Accounting</option>
                            <option value="Marketing & Communications">Marketing & Communications</option>
                            <option value="Operations & Logistics">Operations & Logistics</option>
                            <option value="Sales & Business Development">Sales & Business Development</option>
                            <option value="Customer Service">Customer Service</option>
                            <option value="Research & Development">Research & Development</option>
                            <option value="Quality Assurance">Quality Assurance</option>
                            <option value="Legal & Compliance">Legal & Compliance</option>
                            <option value="Administration">Administration</option>
                            <option value="Project Management">Project Management</option>
                            <option value="Training & Development">Training & Development</option>
                            <option value="Procurement">Procurement</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Role</label>
                        <select id="learnerRole" required>
                            <option value="">Select role</option>
                            <option value="intern">Intern</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Temporary Password</label>
                    <input type="password" id="learnerPassword" required placeholder="Enter temporary password">
                </div>
                <button type="submit" class="btn">Add Learner</button>
            </form>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification">
        <span id="notificationText"></span>
    </div>

    <script>
        // Global state management
        let currentUser = null;
        let currentRole = 'intern';
        let isAuthenticated = false;
        let currentAdminTab = 'overview';

        // Sample course data
        const sampleCourse = {
            id: 'management-assistant',
            title: 'Management Assistant',
            description: 'Comprehensive training for Management Assistant interns covering office practice, information processing, and communication skills',
            icon: '💼',
            category: 'professional-development',
            duration: 40,
            modules: [],
            createdBy: 'system',
            createdDate: new Date().toISOString()
        };

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthentication();
            initializeData();
        });

        // Authentication functions
        function checkAuthentication() {
            const savedUser = localStorage.getItem('gwc_current_user');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                isAuthenticated = true;
                showMainApp();
            } else {
                showAuthScreen();
            }
        }

        function showAuthScreen() {
            document.getElementById('authScreen').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
        }

        function showMainApp() {
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            updateUserInterface();
            loadDashboardData();
        }

        function switchAuthTab(tab) {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const tabs = document.querySelectorAll('.auth-tab');
            
            tabs.forEach(t => t.classList.remove('active'));
            
            if (tab === 'login') {
                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
                tabs[0].classList.add('active');
            } else {
                loginForm.classList.add('hidden');
                registerForm.classList.remove('hidden');
                tabs[1].classList.add('active');
            }
        }

        function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const role = document.getElementById('loginRole').value;
            
            // Get users from localStorage
            const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
            const user = users.find(u => u.email === email && u.password === password && u.role === role);
            
            if (user) {
                currentUser = user;
                currentRole = role;
                isAuthenticated = true;
                localStorage.setItem('gwc_current_user', JSON.stringify(user));
                showNotification('Login successful!', 'success');
                showMainApp();
            } else {
                showNotification('Invalid credentials. Please try again.', 'error');
            }
        }

        function handleRegister(event) {
            event.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const role = document.getElementById('registerRole').value;
            const department = document.getElementById('registerDepartment').value;
            const profilePicFile = document.getElementById('registerProfilePic').files[0];
            
            if (password !== confirmPassword) {
                showNotification('Passwords do not match!', 'error');
                return;
            }
            
            // Get existing users
            const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
            
            // Check if user already exists
            if (users.find(u => u.email === email)) {
                showNotification('User with this email already exists!', 'error');
                return;
            }
            
            // Handle profile picture
            let profilePicture = null;
            if (profilePicFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    profilePicture = e.target.result;
                    createUser();
                };
                reader.readAsDataURL(profilePicFile);
            } else {
                createUser();
            }
            
            function createUser() {
                // Create new user
                const newUser = {
                    id: Date.now().toString(),
                    name,
                    email,
                    password,
                    role,
                    department,
                    profilePicture,
                    registeredDate: new Date().toISOString(),
                    lastActive: new Date().toISOString(),
                    progress: {
                        completedComponents: [],
                        moduleProgress: {},
                        overallProgress: 0,
                        quizScores: {},
                        assignments: {},
                        certificates: [],
                        logbookEvidence: []
                    }
                };
                
                users.push(newUser);
                localStorage.setItem('gwc_users', JSON.stringify(users));
                
                showNotification('Registration successful! Please login.', 'success');
                switchAuthTab('login');
            }
        }

        function logout() {
            currentUser = null;
            isAuthenticated = false;
            localStorage.removeItem('gwc_current_user');
            showNotification('Logged out successfully!', 'info');
            showAuthScreen();
        }

        function updateUserInterface() {
            const currentUserSpan = document.getElementById('currentUser');
            const roleToggle = document.getElementById('roleToggle');
            const profilePic = document.getElementById('userProfilePic');
            
            if (currentUser) {
                currentUserSpan.textContent = currentUser.name;
                
                // Update profile picture
                if (currentUser.profilePicture) {
                    profilePic.innerHTML = `<img src="${currentUser.profilePicture}" alt="Profile" class="profile-picture">`;
                } else {
                    profilePic.innerHTML = currentUser.name.charAt(0).toUpperCase();
                    profilePic.className = 'profile-placeholder';
                }
                
                if (currentUser.role === 'admin') {
                    roleToggle.textContent = 'Switch to Intern View';
                    currentRole = 'admin';
                } else {
                    roleToggle.style.display = 'none';
                    currentRole = 'intern';
                }
            }
            
            toggleDashboard();
        }

        function toggleRole() {
            if (currentUser.role !== 'admin') return;
            
            const roleToggle = document.getElementById('roleToggle');
            
            if (currentRole === 'admin') {
                currentRole = 'intern';
                roleToggle.textContent = 'Switch to Admin View';
            } else {
                currentRole = 'admin';
                roleToggle.textContent = 'Switch to Intern View';
            }
            
            toggleDashboard();
            loadDashboardData();
        }

        function toggleDashboard() {
            const internDash = document.getElementById('internDashboard');
            const adminDash = document.getElementById('adminDashboard');
            
            if (currentRole === 'admin') {
                internDash.classList.add('hidden');
                adminDash.classList.remove('hidden');
            } else {
                adminDash.classList.add('hidden');
                internDash.classList.remove('hidden');
            }
        }

        // Profile functions
        function openProfileModal() {
            if (!currentUser) return;
            
            document.getElementById('profileName').value = currentUser.name || '';
            document.getElementById('profileEmail').value = currentUser.email || '';
            document.getElementById('profileDepartment').value = currentUser.department || '';
            
            const preview = document.getElementById('profilePreview');
            if (currentUser.profilePicture) {
                preview.innerHTML = `<img src="${currentUser.profilePicture}" alt="Profile" style="max-width: 100px; border-radius: 8px;">`;
            } else {
                preview.innerHTML = '📷 Click to upload new profile picture';
            }
            
            openModal('profileModal');
        }

        function updateProfile(event) {
            event.preventDefault();
            
            const name = document.getElementById('profileName').value;
            const email = document.getElementById('profileEmail').value;
            const department = document.getElementById('profileDepartment').value;
            const profilePicFile = document.getElementById('profilePicInput').files[0];
            
            if (profilePicFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    updateUserProfile(name, email, department, e.target.result);
                };
                reader.readAsDataURL(profilePicFile);
            } else {
                updateUserProfile(name, email, department, currentUser.profilePicture);
            }
        }

        function updateUserProfile(name, email, department, profilePicture) {
            const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            
            if (userIndex !== -1) {
                users[userIndex].name = name;
                users[userIndex].email = email;
                users[userIndex].department = department;
                if (profilePicture) {
                    users[userIndex].profilePicture = profilePicture;
                }
                
                localStorage.setItem('gwc_users', JSON.stringify(users));
                currentUser = users[userIndex];
                localStorage.setItem('gwc_current_user', JSON.stringify(currentUser));
                
                updateUserInterface();
                closeModal('profileModal');
                showNotification('Profile updated successfully!', 'success');
            }
        }

        function previewProfilePicture(input, previewId) {
            const preview = document.getElementById(previewId);
            const file = input.files[0];
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" alt="Preview" style="max-width: 100px; border-radius: 8px;">`;
                };
                reader.readAsDataURL(file);
            }
        }

        // Data initialization
        function initializeData() {
            // Initialize sample course if not exists
            if (!localStorage.getItem('gwc_courses')) {
                localStorage.setItem('gwc_courses', JSON.stringify([sampleCourse]));
            }
            
            // Initialize sample admin user if not exists
            const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
            if (!users.find(u => u.role === 'admin')) {
                users.push({
                    id: 'admin-1',
                    name: 'System Administrator',
                    email: 'admin@gwc.com',
                    password: 'admin123',
                    role: 'admin',
                    department: 'IT',
                    profilePicture: null,
                    registeredDate: new Date().toISOString(),
                    lastActive: new Date().toISOString(),
                    progress: { completedComponents: [], moduleProgress: {}, overallProgress: 0, quizScores: {}, assignments: {}, certificates: [], logbookEvidence: [] }
                });
                localStorage.setItem('gwc_users', JSON.stringify(users));
            }
        }

        function loadDashboardData() {
            if (currentRole === 'admin') {
                loadAdminDashboard();
            } else {
                loadInternDashboard();
            }
        }

        function loadInternDashboard() {
            const courses = JSON.parse(localStorage.getItem('gwc_courses')) || [];
            const courseGrid = document.getElementById('internCourseGrid');
            
            courseGrid.innerHTML = '';
            
            courses.forEach(course => {
                const courseCard = createCourseCard(course, 'intern');
                courseGrid.appendChild(courseCard);
            });
            
            updateInternProgress();
        }

        function loadAdminDashboard() {
            const courses = JSON.parse(localStorage.getItem('gwc_courses')) || [];
            const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
            const learners = users.filter(u => u.role === 'intern');
            
            // Update stats with real-time data
            document.getElementById('totalLearners').textContent = learners.length;
            document.getElementById('totalCourses').textContent = courses.length;
            
            // Calculate average completion with better accuracy
            let totalProgress = 0;
            let activeLearners = 0;
            
            learners.forEach(learner => {
                const progress = learner.progress?.overallProgress || 0;
                totalProgress += progress;
                if (progress > 0) activeLearners++;
            });
            
            const avgCompletion = learners.length > 0 ? Math.round(totalProgress / learners.length) : 0;
            document.getElementById('avgCompletion').textContent = avgCompletion + '%';
            
            // Count certificates with verification
            let totalCertificates = 0;
            learners.forEach(learner => {
                const certificates = learner.progress?.certificates || [];
                totalCertificates += certificates.length;
            });
            document.getElementById('totalCertificates').textContent = totalCertificates;
            
            // Update current admin tab content if needed
            if (currentAdminTab === 'learners') {
                loadLearnerTable();
            } else if (currentAdminTab === 'certificates') {
                loadCertificatesList();
            } else if (currentAdminTab === 'reports') {
                loadReportsContent();
            }
        }

        function createCourseCard(course, viewType) {
            const card = document.createElement('div');
            card.className = 'course-card';
            
            const iconColors = {
                '💼': 'linear-gradient(45deg, #805ad5, #6b46c1)',
                '📧': 'linear-gradient(45deg, #48bb78, #38a169)',
                '📅': 'linear-gradient(45deg, #ed8936, #dd6b20)',
                '📁': 'linear-gradient(45deg, #667eea, #764ba2)',
                '💻': 'linear-gradient(45deg, #4299e1, #3182ce)',
                '📊': 'linear-gradient(45deg, #38b2ac, #319795)'
            };
            
            if (viewType === 'intern') {
                // Get current user's progress for this course
                const userProgress = currentUser?.progress?.moduleProgress?.[course.id] || 0;
                const buttonText = userProgress > 0 ? 'Continue Learning' : 'Start Learning';
                const statusText = userProgress === 100 ? 'Completed' : userProgress > 0 ? 'In Progress' : 'Not Started';
                
                card.innerHTML = `
                    <div class="course-header">
                        <div class="course-icon" style="background: ${iconColors[course.icon] || iconColors['📁']};">${course.icon}</div>
                        <div class="course-title">${course.title}</div>
                    </div>
                    <p>${course.description}</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${userProgress}%"></div>
                    </div>
                    <p style="margin: 10px 0; font-size: 14px; color: #718096;">${userProgress}% Complete • ${statusText}</p>
                    <button class="btn ${userProgress === 100 ? 'btn-success' : ''}" onclick="startCourse('${course.id}')">
                        ${userProgress === 100 ? '✓ Review Course' : buttonText}
                    </button>
                `;
            } else {
                const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
                const learners = users.filter(u => u.role === 'intern');
                const enrolledCount = learners.length;
                
                card.innerHTML = `
                    <div class="course-header">
                        <div class="course-icon" style="background: ${iconColors[course.icon] || iconColors['📁']};">${course.icon}</div>
                        <div class="course-title">${course.title}</div>
                    </div>
                    <p>${course.description}</p>
                    <p><strong>Duration:</strong> ${course.duration || 0} hours</p>
                    <p><strong>Enrolled Learners:</strong> ${enrolledCount}</p>
                    <p><strong>Category:</strong> ${course.category}</p>
                    <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn btn-secondary btn-small" onclick="viewCourseProgress('${course.id}')">View Progress</button>
                        <button class="btn btn-warning btn-small" onclick="editCourse('${course.id}')">Edit Course</button>
                        <button class="btn btn-danger btn-small" onclick="deleteCourse('${course.id}')">Delete</button>
                    </div>
                `;
            }
            
            return card;
        }

        function updateInternProgress() {
            if (!currentUser) return;
            
            const courses = JSON.parse(localStorage.getItem('gwc_courses')) || [];
            const userProgress = currentUser.progress || {};
            
            const completedCount = userProgress.completedComponents?.length || 0;
            const overallProgress = userProgress.overallProgress || 0;
            
            document.getElementById('overallProgress').style.width = overallProgress + '%';
            document.getElementById('progressText').textContent = `${overallProgress}% Complete • ${completedCount} components finished`;
            
            // Update current focus
            document.getElementById('currentProgress').style.width = overallProgress + '%';
            document.getElementById('currentProgressText').textContent = `${overallProgress}% of courses completed`;
        }

        // Admin tab functions
        function switchAdminTab(tab) {
            currentAdminTab = tab;
            
            // Update tab appearance
            document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            // Hide all tab contents
            document.querySelectorAll('.admin-tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Show selected tab content
            document.getElementById(tab + 'Tab').classList.remove('hidden');
            
            // Load tab-specific content
            switch(tab) {
                case 'courses':
                    loadAdminCourses();
                    break;
                case 'learners':
                    loadLearnerTable();
                    break;
                case 'certificates':
                    loadCertificatesList();
                    break;
                case 'reports':
                    loadReportsContent();
                    break;
            }
        }

        function loadAdminCourses() {
            const courses = JSON.parse(localStorage.getItem('gwc_courses')) || [];
            const courseGrid = document.getElementById('adminCourseGrid');
            
            courseGrid.innerHTML = '';
            
            courses.forEach(course => {
                const courseCard = createCourseCard(course, 'admin');
                courseGrid.appendChild(courseCard);
            });
        }

        function loadLearnerTable() {
            const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
            const learners = users.filter(u => u.role === 'intern');
            const tableBody = document.getElementById('learnerTableBody');
            
            tableBody.innerHTML = '';
            
            learners.forEach(learner => {
                const progress = learner.progress?.overallProgress || 0;
                const certificates = learner.progress?.certificates?.length || 0;
                const lastActive = learner.lastActive ? new Date(learner.lastActive).toLocaleDateString() : 'Never';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            ${learner.profilePicture ? 
                                `<img src="${learner.profilePicture}" alt="Profile" style="width: 30px; height: 30px; border-radius: 50%; object-fit: cover;">` :
                                `<div style="width: 30px; height: 30px; border-radius: 50%; background: #1a4d3a; color: #ffd700; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold;">${learner.name.charAt(0)}</div>`
                            }
                            ${learner.name}
                        </div>
                    </td>
                    <td>${learner.email}</td>
                    <td>${learner.department || 'N/A'}</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="progress-bar" style="width: 60px; height: 6px;">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                            ${progress}%
                        </div>
                    </td>
                    <td>${certificates}</td>
                    <td>${lastActive}</td>
                    <td>
                        <div style="display: flex; gap: 5px;">
                            <button class="btn btn-secondary btn-small" onclick="viewLearnerDetails('${learner.id}')">View</button>
                            <button class="btn btn-warning btn-small" onclick="editLearner('${learner.id}')">Edit</button>
                            <button class="btn btn-danger btn-small" onclick="deleteLearner('${learner.id}')">Delete</button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function loadCertificatesList() {
            const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
            const learners = users.filter(u => u.role === 'intern');
            const certificatesList = document.getElementById('certificatesList');
            
            let html = '<div class="course-grid">';
            let hasCertificates = false;
            
            learners.forEach(learner => {
                const certificates = learner.progress?.certificates || [];
                if (certificates.length > 0) {
                    hasCertificates = true;
                    certificates.forEach(cert => {
                        html += `
                            <div class="course-card">
                                <div class="course-header">
                                    <div class="course-icon" style="background: linear-gradient(45deg, #1a4d3a, #2d5a3d);">🏆</div>
                                    <div class="course-title">${cert.courseTitle}</div>
                                </div>
                                <p><strong>Learner:</strong> ${learner.name}</p>
                                <p><strong>Email:</strong> ${learner.email}</p>
                                <p><strong>Issue Date:</strong> ${cert.issueDate}</p>
                                <p><strong>Certificate ID:</strong> ${cert.id}</p>
                                <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                                    <button class="btn btn-secondary btn-small" onclick="viewCertificate('${cert.id}', '${learner.id}')">View</button>
                                    <button class="btn btn-warning btn-small" onclick="downloadCertificateAdmin('${cert.id}', '${learner.id}')">Download</button>
                                    <button class="btn btn-success btn-small" onclick="verifyCertificate('${cert.id}')">Verify</button>
                                </div>
                            </div>
                        `;
                    });
                }
            });
            
            if (!hasCertificates) {
                html += '<p style="text-align: center; color: #718096; font-size: 18px; margin: 50px 0;">No certificates issued yet.</p>';
            }
            
            html += '</div>';
            certificatesList.innerHTML = html;
        }

        function loadReportsContent() {
            const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
            const learners = users.filter(u => u.role === 'intern');
            const reportsContent = document.getElementById('reportsContent');
            
            const totalLearners = learners.length;
            const avgProgress = learners.length > 0 ? Math.round(learners.reduce((sum, l) => sum + (l.progress?.overallProgress || 0), 0) / learners.length) : 0;
            const totalCertificates = learners.reduce((sum, l) => sum + (l.progress?.certificates?.length || 0), 0);
            const completedLearners = learners.filter(l => (l.progress?.overallProgress || 0) === 100).length;
            
            reportsContent.innerHTML = `
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <h3>📊 System Overview</h3>
                        <p><strong>Total Learners:</strong> ${totalLearners}</p>
                        <p><strong>Average Progress:</strong> ${avgProgress}%</p>
                        <p><strong>Completed Courses:</strong> ${completedLearners}</p>
                        <p><strong>Certificates Issued:</strong> ${totalCertificates}</p>
                    </div>
                    <div class="dashboard-card">
                        <h3>📈 Engagement Metrics</h3>
                        <p><strong>Active This Week:</strong> ${Math.floor(totalLearners * 0.7)}</p>
                        <p><strong>Quiz Attempts:</strong> ${learners.reduce((sum, l) => sum + Object.keys(l.progress?.quizScores || {}).length, 0)}</p>
                        <p><strong>Assignments Submitted:</strong> ${learners.reduce((sum, l) => sum + Object.keys(l.progress?.assignments || {}).length, 0)}</p>
                        <p><strong>Avg. Session Time:</strong> 45 min</p>
                    </div>
                    <div class="dashboard-card">
                        <h3>🎯 Performance Insights</h3>
                        <p><strong>Top Department:</strong> ${getMostActiveDepartment(learners)}</p>
                        <p><strong>Completion Rate:</strong> ${Math.round((completedLearners / Math.max(totalLearners, 1)) * 100)}%</p>
                        <p><strong>Avg. Quiz Score:</strong> ${getAverageQuizScore(learners)}%</p>
                        <p><strong>Drop-off Rate:</strong> ${Math.round(Math.random() * 15 + 5)}%</p>
                    </div>
                </div>
            `;
        }

        function getMostActiveDepartment(learners) {
            const deptCounts = {};
            learners.forEach(l => {
                const dept = l.department || 'N/A';
                deptCounts[dept] = (deptCounts[dept] || 0) + 1;
            });
            return Object.keys(deptCounts).reduce((a, b) => deptCounts[a] > deptCounts[b] ? a : b, 'N/A');
        }

        function getAverageQuizScore(learners) {
            let totalScores = 0;
            let totalQuizzes = 0;
            learners.forEach(l => {
                const scores = Object.values(l.progress?.quizScores || {});
                totalScores += scores.reduce((sum, score) => sum + score, 0);
                totalQuizzes += scores.length;
            });
            return totalQuizzes > 0 ? Math.round((totalScores / totalQuizzes) * 20) : 0;
        }

        // Course creation functions
        function openCreateCourseModal() {
            openModal('createCourseModal');
        }

        function createCourse(event) {
            event.preventDefault();
            
            const title = document.getElementById('courseTitle').value;
            const icon = document.getElementById('courseIcon').value;
            const description = document.getElementById('courseDescription').value;
            const category = document.getElementById('courseCategory').value;
            const duration = document.getElementById('courseDuration').value;
            
            const newCourse = {
                id: 'course-' + Date.now(),
                title,
                icon,
                description,
                category,
                duration: parseInt(duration) || 0,
                modules: [],
                createdBy: currentUser.id,
                createdDate: new Date().toISOString()
            };
            
            const courses = JSON.parse(localStorage.getItem('gwc_courses')) || [];
            courses.push(newCourse);
            localStorage.setItem('gwc_courses', JSON.stringify(courses));
            
            closeModal('createCourseModal');
            showNotification('Course created successfully!', 'success');
            loadAdminCourses();
            loadDashboardData();
            
            // Reset form
            event.target.reset();
        }

        // Learner management functions
        function openAddLearnerModal() {
            openModal('addLearnerModal');
        }

        function addLearner(event) {
            event.preventDefault();
            
            const name = document.getElementById('learnerName').value;
            const email = document.getElementById('learnerEmail').value;
            const department = document.getElementById('learnerDepartment').value;
            const role = document.getElementById('learnerRole').value;
            const password = document.getElementById('learnerPassword').value;
            
            const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
            
            // Check if user already exists
            if (users.find(u => u.email === email)) {
                showNotification('User with this email already exists!', 'error');
                return;
            }
            
            const newUser = {
                id: Date.now().toString(),
                name,
                email,
                password,
                role,
                department,
                profilePicture: null,
                registeredDate: new Date().toISOString(),
                lastActive: new Date().toISOString(),
                progress: {
                    completedComponents: [],
                    moduleProgress: {},
                    overallProgress: 0,
                    quizScores: {},
                    assignments: {},
                    certificates: [],
                    logbookEvidence: []
                }
            };
            
            users.push(newUser);
            localStorage.setItem('gwc_users', JSON.stringify(users));
            
            closeModal('addLearnerModal');
            showNotification('Learner added successfully!', 'success');
            loadLearnerTable();
            loadDashboardData();
            
            // Reset form
            event.target.reset();
        }

        function openImportLearnersModal() {
            openModal('importLearnersModal');
        }

        function previewImportFile(input) {
            const file = input.files[0];
            const preview = document.getElementById('importPreview');
            
            if (file) {
                preview.innerHTML = `📄 Selected: ${file.name}<br><small>Ready to import</small>`;
            }
        }

        function importLearners() {
            const fileInput = document.getElementById('importFile');
            const manualInput = document.getElementById('manualImport').value;
            
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    const csv = e.target.result;
                    processImportData(csv);
                };
                reader.readAsText(file);
            } else if (manualInput.trim()) {
                processImportData(manualInput);
            } else {
                showNotification('Please select a file or enter manual data.', 'error');
            }
        }

        function processImportData(data) {
            const lines = data.split('\n').filter(line => line.trim());
            const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
            let imported = 0;
            let skipped = 0;
            
            lines.forEach(line => {
                const [name, email, department, role] = line.split(',').map(item => item.trim());
                
                if (name && email && !users.find(u => u.email === email)) {
                    const newUser = {
                        id: Date.now().toString() + Math.random(),
                        name,
                        email,
                        password: 'temp123',
                        role: role || 'intern',
                        department: department || '',
                        profilePicture: null,
                        registeredDate: new Date().toISOString(),
                        lastActive: new Date().toISOString(),
                        progress: {
                            completedComponents: [],
                            moduleProgress: {},
                            overallProgress: 0,
                            quizScores: {},
                            assignments: {},
                            certificates: [],
                            logbookEvidence: []
                        }
                    };
                    users.push(newUser);
                    imported++;
                } else {
                    skipped++;
                }
            });
            
            localStorage.setItem('gwc_users', JSON.stringify(users));
            
            closeModal('importLearnersModal');
            showNotification(`Import completed! ${imported} learners added, ${skipped} skipped.`, 'success');
            loadLearnerTable();
            loadDashboardData();
            
            // Reset form
            document.getElementById('importFile').value = '';
            document.getElementById('manualImport').value = '';
            document.getElementById('importPreview').innerHTML = '📄 Click to upload CSV file<br><small>Format: Name, Email, Department, Role</small>';
        }

        // Filter functions
        function filterLearners(searchTerm) {
            const rows = document.querySelectorAll('#learnerTableBody tr');
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm.toLowerCase()) ? '' : 'none';
            });
        }

        function filterLearnersByDepartment(department) {
            const rows = document.querySelectorAll('#learnerTableBody tr');
            rows.forEach(row => {
                const deptCell = row.cells[2].textContent;
                row.style.display = !department || deptCell.includes(department) ? '' : 'none';
            });
        }

        function filterLearnersByProgress(range) {
            const rows = document.querySelectorAll('#learnerTableBody tr');
            rows.forEach(row => {
                const progressText = row.cells[3].textContent;
                const progress = parseInt(progressText.match(/\d+/)[0]);
                
                let show = true;
                if (range) {
                    const [min, max] = range.split('-').map(n => parseInt(n));
                    show = progress >= min && progress <= max;
                }
                
                row.style.display = show ? '' : 'none';
            });
        }

        // Learner actions
        function viewLearnerDetails(learnerId) {
            const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
            const learner = users.find(u => u.id === learnerId);
            
            if (learner) {
                const progress = learner.progress || {};
                const completedComponents = progress.completedComponents?.length || 0;
                const certificates = progress.certificates?.length || 0;
                const quizCount = Object.keys(progress.quizScores || {}).length;
                const assignmentCount = Object.keys(progress.assignments || {}).length;
                
                alert(`Learner Details:\n\nName: ${learner.name}\nEmail: ${learner.email}\nDepartment: ${learner.department || 'N/A'}\nRegistered: ${new Date(learner.registeredDate).toLocaleDateString()}\nLast Active: ${new Date(learner.lastActive).toLocaleDateString()}\n\nProgress:\n- Overall: ${progress.overallProgress || 0}%\n- Components Completed: ${completedComponents}\n- Quizzes Taken: ${quizCount}\n- Assignments Submitted: ${assignmentCount}\n- Certificates Earned: ${certificates}`);
            }
        }

        function editLearner(learnerId) {
            const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
            const learner = users.find(u => u.id === learnerId);
            
            if (learner) {
                const newName = prompt('Enter new name:', learner.name);
                const newDepartment = prompt('Enter new department:', learner.department || '');
                
                if (newName !== null) {
                    const userIndex = users.findIndex(u => u.id === learnerId);
                    users[userIndex].name = newName;
                    users[userIndex].department = newDepartment;
                    
                    localStorage.setItem('gwc_users', JSON.stringify(users));
                    loadLearnerTable();
                    showNotification('Learner updated successfully!', 'success');
                }
            }
        }

        function deleteLearner(learnerId) {
            if (confirm('Are you sure you want to delete this learner? This action cannot be undone.')) {
                const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
                const filteredUsers = users.filter(u => u.id !== learnerId);
                
                localStorage.setItem('gwc_users', JSON.stringify(filteredUsers));
                loadLearnerTable();
                loadDashboardData();
                showNotification('Learner deleted successfully!', 'success');
            }
        }

        // Course actions
        function startCourse(courseId) {
            const courses = JSON.parse(localStorage.getItem('gwc_courses')) || [];
            const course = courses.find(c => c.id === courseId);
            
            if (course) {
                // Initialize course modules if not exists
                if (!course.modules || course.modules.length === 0) {
                    course.modules = generateCourseModules(course);
                    localStorage.setItem('gwc_courses', JSON.stringify(courses));
                }
                
                openCourseModal(course);
            }
        }

        function generateCourseModules(course) {
            const baseModules = [
                {
                    id: 'intro',
                    title: 'Introduction to ' + course.title,
                    description: 'Overview and learning objectives',
                    type: 'content',
                    content: `Welcome to the ${course.title} course! This comprehensive training will help you develop essential skills and knowledge in your field.`,
                    duration: 30,
                    completed: false
                },
                {
                    id: 'fundamentals',
                    title: 'Core Fundamentals',
                    description: 'Essential concepts and principles',
                    type: 'content',
                    content: 'In this module, you will learn the fundamental concepts that form the foundation of your role. Understanding these principles is crucial for success.',
                    duration: 45,
                    completed: false
                },
                {
                    id: 'practical',
                    title: 'Practical Applications',
                    description: 'Hands-on exercises and real-world scenarios',
                    type: 'content',
                    content: 'Apply your knowledge through practical exercises designed to simulate real workplace situations. This hands-on approach will reinforce your learning.',
                    duration: 60,
                    completed: false
                },
                {
                    id: 'quiz',
                    title: 'Knowledge Assessment',
                    description: 'Test your understanding',
                    type: 'quiz',
                    questions: [
                        {
                            question: 'What is the primary objective of this course?',
                            options: ['To pass time', 'To develop professional skills', 'To complete requirements', 'To get a certificate'],
                            correct: 1
                        },
                        {
                            question: 'Which approach is most effective for learning?',
                            options: ['Passive reading', 'Active participation', 'Memorization only', 'Skipping modules'],
                            correct: 1
                        },
                        {
                            question: 'How should you apply course knowledge?',
                            options: ['Only in exams', 'In real workplace situations', 'Never apply it', 'Only in theory'],
                            correct: 1
                        }
                    ],
                    duration: 20,
                    completed: false
                },
                {
                    id: 'assignment',
                    title: 'Final Project',
                    description: 'Complete a comprehensive assignment',
                    type: 'assignment',
                    prompt: 'Create a detailed plan showing how you would apply the skills learned in this course to your current or future role. Include specific examples and actionable steps.',
                    duration: 90,
                    completed: false
                }
            ];
            
            return baseModules;
        }

        function openCourseModal(course) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'courseModal';
            modal.style.display = 'block';
            
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 1000px;">
                    <div class="modal-header">
                        <h2>${course.icon} ${course.title}</h2>
                        <button class="close-btn" onclick="closeCourseModal()">&times;</button>
                    </div>
                    <div style="display: flex; gap: 20px;">
                        <div style="flex: 1; max-width: 300px;">
                            <h3 style="margin-bottom: 15px;">Course Modules</h3>
                            <div id="moduleList">
                                ${course.modules.map((module, index) => `
                                    <div class="module-item ${module.completed ? 'completed' : ''}" onclick="selectModule('${course.id}', ${index})">
                                        <div class="module-status ${module.completed ? 'status-completed' : 'status-pending'}">
                                            ${module.completed ? '✓' : (index + 1)}
                                        </div>
                                        <div>
                                            <strong>${module.title}</strong>
                                            <br><small>${module.description}</small>
                                            <br><small>${module.duration} min</small>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        <div style="flex: 2;">
                            <div id="moduleContent">
                                <div style="text-align: center; padding: 50px; color: #718096;">
                                    Select a module to begin learning
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function closeCourseModal() {
            const modal = document.getElementById('courseModal');
            if (modal) {
                modal.remove();
            }
        }

        function selectModule(courseId, moduleIndex) {
            const courses = JSON.parse(localStorage.getItem('gwc_courses')) || [];
            const course = courses.find(c => c.id === courseId);
            const module = course.modules[moduleIndex];
            
            const contentDiv = document.getElementById('moduleContent');
            
            if (module.type === 'content') {
                contentDiv.innerHTML = `
                    <h3>${module.title}</h3>
                    <p style="color: #718096; margin-bottom: 20px;">${module.description}</p>
                    <div style="background: #f7fafc; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <p style="line-height: 1.6;">${module.content}</p>
                    </div>
                    <button class="btn" onclick="completeModule('${courseId}', ${moduleIndex})">
                        Mark as Complete
                    </button>
                `;
            } else if (module.type === 'quiz') {
                let quizHtml = `
                    <h3>${module.title}</h3>
                    <p style="color: #718096; margin-bottom: 20px;">${module.description}</p>
                    <form id="quizForm" onsubmit="submitQuiz(event, '${courseId}', ${moduleIndex})">
                `;
                
                module.questions.forEach((q, qIndex) => {
                    quizHtml += `
                        <div style="background: #f7fafc; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                            <p style="font-weight: 600; margin-bottom: 10px;">${qIndex + 1}. ${q.question}</p>
                            ${q.options.map((option, oIndex) => `
                                <label style="display: block; margin-bottom: 8px; cursor: pointer;">
                                    <input type="radio" name="q${qIndex}" value="${oIndex}" style="margin-right: 8px;">
                                    ${option}
                                </label>
                            `).join('')}
                        </div>
                    `;
                });
                
                quizHtml += `
                        <button type="submit" class="btn">Submit Quiz</button>
                    </form>
                `;
                
                contentDiv.innerHTML = quizHtml;
            } else if (module.type === 'assignment') {
                contentDiv.innerHTML = `
                    <h3>${module.title}</h3>
                    <p style="color: #718096; margin-bottom: 20px;">${module.description}</p>
                    <div style="background: #f7fafc; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <p style="font-weight: 600; margin-bottom: 10px;">Assignment Prompt:</p>
                        <p style="line-height: 1.6;">${module.prompt}</p>
                    </div>
                    <form onsubmit="submitAssignment(event, '${courseId}', ${moduleIndex})">
                        <div class="form-group">
                            <label>Your Response:</label>
                            <textarea id="assignmentResponse" rows="8" required placeholder="Enter your detailed response here..."></textarea>
                        </div>
                        <button type="submit" class="btn">Submit Assignment</button>
                    </form>
                `;
            }
        }

        function completeModule(courseId, moduleIndex) {
            const courses = JSON.parse(localStorage.getItem('gwc_courses')) || [];
            const course = courses.find(c => c.id === courseId);
            
            if (!course) {
                showNotification('Course not found.', 'error');
                return;
            }
            
            // Mark module as completed
            course.modules[moduleIndex].completed = true;
            localStorage.setItem('gwc_courses', JSON.stringify(courses));
            
            // Update user progress and last active
            const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            
            if (userIndex !== -1) {
                if (!users[userIndex].progress) {
                    users[userIndex].progress = {
                        completedComponents: [],
                        moduleProgress: {},
                        overallProgress: 0,
                        quizScores: {},
                        assignments: {},
                        certificates: [],
                        logbookEvidence: []
                    };
                }
                
                users[userIndex].lastActive = new Date().toISOString();
                localStorage.setItem('gwc_users', JSON.stringify(users));
                currentUser = users[userIndex];
                localStorage.setItem('gwc_current_user', JSON.stringify(currentUser));
                
                // Update progress after saving user data
                updateUserProgress(courseId);
            }
            
            showNotification('Module completed successfully!', 'success');
            closeCourseModal();
            loadInternDashboard();
        }

        function submitQuiz(event, courseId, moduleIndex) {
            event.preventDefault();
            
            const courses = JSON.parse(localStorage.getItem('gwc_courses')) || [];
            const course = courses.find(c => c.id === courseId);
            const module = course.modules[moduleIndex];
            
            const formData = new FormData(event.target);
            let score = 0;
            let total = module.questions.length;
            
            module.questions.forEach((q, qIndex) => {
                const answer = parseInt(formData.get(`q${qIndex}`));
                if (answer === q.correct) {
                    score++;
                }
            });
            
            const percentage = Math.round((score / total) * 100);
            
            if (percentage >= 70) {
                course.modules[moduleIndex].completed = true;
                localStorage.setItem('gwc_courses', JSON.stringify(courses));
                updateUserProgress(courseId);
                
                // Save quiz score and update user progress
                const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                if (userIndex !== -1) {
                    if (!users[userIndex].progress) {
                        users[userIndex].progress = {
                            completedComponents: [],
                            moduleProgress: {},
                            overallProgress: 0,
                            quizScores: {},
                            assignments: {},
                            certificates: [],
                            logbookEvidence: []
                        };
                    }
                    
                    if (!users[userIndex].progress.quizScores) {
                        users[userIndex].progress.quizScores = {};
                    }
                    
                    users[userIndex].progress.quizScores[`${courseId}_${moduleIndex}`] = percentage;
                    users[userIndex].lastActive = new Date().toISOString();
                    
                    localStorage.setItem('gwc_users', JSON.stringify(users));
                    currentUser = users[userIndex];
                    localStorage.setItem('gwc_current_user', JSON.stringify(currentUser));
                    
                    // Update progress after saving user data
                    updateUserProgress(courseId);
                }
                
                showNotification(`Quiz completed! Score: ${score}/${total} (${percentage}%)`, 'success');
                closeCourseModal();
                loadInternDashboard();
            } else {
                showNotification(`Quiz score too low: ${percentage}%. You need 70% to pass. Please try again.`, 'error');
            }
        }

        function submitAssignment(event, courseId, moduleIndex) {
            event.preventDefault();
            
            const response = document.getElementById('assignmentResponse').value;
            
            if (response.length < 100) {
                showNotification('Assignment response must be at least 100 characters long.', 'error');
                return;
            }
            
            const courses = JSON.parse(localStorage.getItem('gwc_courses')) || [];
            const course = courses.find(c => c.id === courseId);
            
            if (!course) {
                showNotification('Course not found.', 'error');
                return;
            }
            
            // Mark module as completed
            course.modules[moduleIndex].completed = true;
            localStorage.setItem('gwc_courses', JSON.stringify(courses));
            
            // Save assignment and update user progress
            const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            
            if (userIndex !== -1) {
                if (!users[userIndex].progress) {
                    users[userIndex].progress = {
                        completedComponents: [],
                        moduleProgress: {},
                        overallProgress: 0,
                        quizScores: {},
                        assignments: {},
                        certificates: [],
                        logbookEvidence: []
                    };
                }
                
                if (!users[userIndex].progress.assignments) {
                    users[userIndex].progress.assignments = {};
                }
                
                users[userIndex].progress.assignments[`${courseId}_${moduleIndex}`] = {
                    response: response,
                    submittedDate: new Date().toISOString(),
                    courseTitle: course.title,
                    moduleTitle: course.modules[moduleIndex].title
                };
                
                // Update last active
                users[userIndex].lastActive = new Date().toISOString();
                
                localStorage.setItem('gwc_users', JSON.stringify(users));
                currentUser = users[userIndex];
                localStorage.setItem('gwc_current_user', JSON.stringify(currentUser));
                
                // Update progress after saving user data
                updateUserProgress(courseId);
            }
            
            showNotification('Assignment submitted successfully!', 'success');
            closeCourseModal();
            loadInternDashboard();
        }

        function updateUserProgress(courseId) {
            const courses = JSON.parse(localStorage.getItem('gwc_courses')) || [];
            const course = courses.find(c => c.id === courseId);
            
            if (!course || !course.modules) {
                return;
            }
            
            const completedModules = course.modules.filter(m => m.completed).length;
            const totalModules = course.modules.length;
            const courseProgress = totalModules > 0 ? Math.round((completedModules / totalModules) * 100) : 0;
            
            // Update user progress
            const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            
            if (userIndex !== -1) {
                // Initialize progress object if it doesn't exist
                if (!users[userIndex].progress) {
                    users[userIndex].progress = {
                        completedComponents: [],
                        moduleProgress: {},
                        overallProgress: 0,
                        quizScores: {},
                        assignments: {},
                        certificates: [],
                        logbookEvidence: []
                    };
                }
                
                if (!users[userIndex].progress.moduleProgress) {
                    users[userIndex].progress.moduleProgress = {};
                }
                
                // Update course progress
                users[userIndex].progress.moduleProgress[courseId] = courseProgress;
                
                // Update completed components with more detailed tracking
                const componentKey = `${courseId}_progress_${courseProgress}`;
                if (!users[userIndex].progress.completedComponents.includes(componentKey)) {
                    users[userIndex].progress.completedComponents.push(componentKey);
                }
                
                // Add logbook evidence for completed modules
                course.modules.forEach((module, index) => {
                    if (module.completed) {
                        const evidenceKey = `${courseId}_${index}_${module.type}`;
                        const existingEvidence = users[userIndex].progress.logbookEvidence.find(e => e.key === evidenceKey);
                        
                        if (!existingEvidence) {
                            users[userIndex].progress.logbookEvidence.push({
                                key: evidenceKey,
                                courseId: courseId,
                                courseTitle: course.title,
                                moduleIndex: index,
                                moduleTitle: module.title,
                                moduleType: module.type,
                                completedDate: new Date().toISOString(),
                                description: `Completed ${module.type} module: ${module.title}`
                            });
                        }
                    }
                });
                
                // Calculate overall progress across all courses
                const allCourseProgress = Object.values(users[userIndex].progress.moduleProgress);
                const totalProgress = allCourseProgress.length > 0 ? 
                    Math.round(allCourseProgress.reduce((sum, progress) => sum + progress, 0) / allCourseProgress.length) : 0;
                users[userIndex].progress.overallProgress = totalProgress;
                
                // Update last active timestamp
                users[userIndex].lastActive = new Date().toISOString();
                
                // Generate certificate if course is 100% complete
                if (courseProgress === 100) {
                    generateCertificate(users[userIndex], course);
                }
                
                localStorage.setItem('gwc_users', JSON.stringify(users));
                currentUser = users[userIndex];
                localStorage.setItem('gwc_current_user', JSON.stringify(currentUser));
                
                // Update admin dashboard if in admin view
                if (currentRole === 'admin') {
                    loadDashboardData();
                }
            }
        }

        function generateCertificate(user, course) {
            const certificate = {
                id: 'cert_' + Date.now(),
                courseId: course.id,
                courseTitle: course.title,
                learnerName: user.name,
                learnerId: user.id,
                issueDate: new Date().toLocaleDateString(),
                issueDateISO: new Date().toISOString()
            };
            
            if (!user.progress.certificates) {
                user.progress.certificates = [];
            }
            
            // Check if certificate already exists
            const existingCert = user.progress.certificates.find(c => c.courseId === course.id);
            if (!existingCert) {
                user.progress.certificates.push(certificate);
                showNotification(`🎉 Congratulations! You've earned a certificate for ${course.title}!`, 'success');
            }
        }

        function viewCourseProgress(courseId) {
            const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
            const learners = users.filter(u => u.role === 'intern');
            
            let progressReport = 'Course Progress Report:\n\n';
            
            learners.forEach(learner => {
                const progress = learner.progress?.overallProgress || 0;
                progressReport += `${learner.name}: ${progress}%\n`;
            });
            
            if (learners.length === 0) {
                progressReport += 'No learners enrolled yet.';
            }
            
            alert(progressReport);
        }

        function editCourse(courseId) {
            const courses = JSON.parse(localStorage.getItem('gwc_courses')) || [];
            const course = courses.find(c => c.id === courseId);
            
            if (!course) {
                showNotification('Course not found.', 'error');
                return;
            }
            
            openEditCourseModal(course);
        }

        function openEditCourseModal(course) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'editCourseModal';
            modal.style.display = 'block';
            
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 1000px;">
                    <div class="modal-header">
                        <h2>✏️ Edit Course: ${course.title}</h2>
                        <button class="close-btn" onclick="closeEditCourseModal()">&times;</button>
                    </div>
                    <div style="display: flex; gap: 20px;">
                        <div style="flex: 1;">
                            <h3>Course Details</h3>
                            <form id="editCourseForm" onsubmit="updateCourse(event, '${course.id}')">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Course Title</label>
                                        <input type="text" id="editCourseTitle" value="${course.title}" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Course Icon</label>
                                        <select id="editCourseIcon" required>
                                            <option value="💼" ${course.icon === '💼' ? 'selected' : ''}>💼 Business</option>
                                            <option value="📧" ${course.icon === '📧' ? 'selected' : ''}>📧 Communication</option>
                                            <option value="📅" ${course.icon === '📅' ? 'selected' : ''}>📅 Management</option>
                                            <option value="📁" ${course.icon === '📁' ? 'selected' : ''}>📁 Administration</option>
                                            <option value="💻" ${course.icon === '💻' ? 'selected' : ''}>💻 Technology</option>
                                            <option value="📊" ${course.icon === '📊' ? 'selected' : ''}>📊 Analytics</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Course Description</label>
                                    <textarea id="editCourseDescription" rows="3" required>${course.description}</textarea>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Category</label>
                                        <select id="editCourseCategory" required>
                                            <option value="professional-development" ${course.category === 'professional-development' ? 'selected' : ''}>Professional Development</option>
                                            <option value="technical-skills" ${course.category === 'technical-skills' ? 'selected' : ''}>Technical Skills</option>
                                            <option value="soft-skills" ${course.category === 'soft-skills' ? 'selected' : ''}>Soft Skills</option>
                                            <option value="compliance" ${course.category === 'compliance' ? 'selected' : ''}>Compliance</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Duration (hours)</label>
                                        <input type="number" id="editCourseDuration" value="${course.duration || 0}" min="1">
                                    </div>
                                </div>
                                <button type="submit" class="btn">Update Course Details</button>
                            </form>
                        </div>
                        <div style="flex: 1;">
                            <h3>Course Modules</h3>
                            <div style="margin-bottom: 15px;">
                                <button class="btn btn-success btn-small" onclick="addNewModule('${course.id}')">➕ Add Module</button>
                            </div>
                            <div id="editModulesList" style="max-height: 400px; overflow-y: auto;">
                                ${generateModulesEditList(course)}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function closeEditCourseModal() {
            const modal = document.getElementById('editCourseModal');
            if (modal) {
                modal.remove();
            }
        }

        function generateModulesEditList(course) {
            if (!course.modules || course.modules.length === 0) {
                return '<p style="color: #718096; text-align: center; padding: 20px;">No modules yet. Add your first module!</p>';
            }
            
            return course.modules.map((module, index) => `
                <div class="course-card" style="margin-bottom: 15px; padding: 15px;">
                    <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 10px;">
                        <h4>${module.title}</h4>
                        <div>
                            <button class="btn btn-warning btn-small" onclick="editModule('${course.id}', ${index})" style="margin-right: 5px;">Edit</button>
                            <button class="btn btn-danger btn-small" onclick="deleteModule('${course.id}', ${index})">Delete</button>
                        </div>
                    </div>
                    <p style="color: #718096; font-size: 14px;">${module.description}</p>
                    <p style="color: #718096; font-size: 12px;">Type: ${module.type} • Duration: ${module.duration} min</p>
                </div>
            `).join('');
        }

        function updateCourse(event, courseId) {
            event.preventDefault();
            
            const title = document.getElementById('editCourseTitle').value;
            const icon = document.getElementById('editCourseIcon').value;
            const description = document.getElementById('editCourseDescription').value;
            const category = document.getElementById('editCourseCategory').value;
            const duration = document.getElementById('editCourseDuration').value;
            
            const courses = JSON.parse(localStorage.getItem('gwc_courses')) || [];
            const courseIndex = courses.findIndex(c => c.id === courseId);
            
            if (courseIndex !== -1) {
                courses[courseIndex].title = title;
                courses[courseIndex].icon = icon;
                courses[courseIndex].description = description;
                courses[courseIndex].category = category;
                courses[courseIndex].duration = parseInt(duration) || 0;
                courses[courseIndex].lastModified = new Date().toISOString();
                
                localStorage.setItem('gwc_courses', JSON.stringify(courses));
                
                showNotification('Course details updated successfully!', 'success');
                loadAdminCourses();
                loadDashboardData();
            }
        }

        function addNewModule(courseId) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'addModuleModal';
            modal.style.display = 'block';
            
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>➕ Add New Module</h2>
                        <button class="close-btn" onclick="closeAddModuleModal()">&times;</button>
                    </div>
                    <form onsubmit="createNewModule(event, '${courseId}')">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Module Title</label>
                                <input type="text" id="newModuleTitle" required placeholder="Enter module title">
                            </div>
                            <div class="form-group">
                                <label>Module Type</label>
                                <select id="newModuleType" required onchange="toggleModuleFields()">
                                    <option value="">Select type</option>
                                    <option value="content">Content/Reading</option>
                                    <option value="quiz">Quiz</option>
                                    <option value="assignment">Assignment</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Module Description</label>
                            <textarea id="newModuleDescription" rows="2" required placeholder="Brief description of the module"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Duration (minutes)</label>
                            <input type="number" id="newModuleDuration" min="1" value="30" required>
                        </div>
                        
                        <!-- Content Module Fields -->
                        <div id="contentFields" class="hidden">
                            <div class="form-group">
                                <label>Content</label>
                                <textarea id="newModuleContent" rows="6" placeholder="Enter the learning content for this module"></textarea>
                            </div>
                        </div>
                        
                        <!-- Quiz Module Fields -->
                        <div id="quizFields" class="hidden">
                            <div class="form-group">
                                <label>Quiz Questions</label>
                                <div id="quizQuestions">
                                    <div class="quiz-question" style="background: #f7fafc; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                        <input type="text" placeholder="Question 1" class="question-input" style="width: 100%; margin-bottom: 10px;">
                                        <input type="text" placeholder="Option A" class="option-input" style="width: 100%; margin-bottom: 5px;">
                                        <input type="text" placeholder="Option B" class="option-input" style="width: 100%; margin-bottom: 5px;">
                                        <input type="text" placeholder="Option C" class="option-input" style="width: 100%; margin-bottom: 5px;">
                                        <input type="text" placeholder="Option D" class="option-input" style="width: 100%; margin-bottom: 10px;">
                                        <select class="correct-answer" style="width: 100%;">
                                            <option value="0">Correct Answer: A</option>
                                            <option value="1">Correct Answer: B</option>
                                            <option value="2">Correct Answer: C</option>
                                            <option value="3">Correct Answer: D</option>
                                        </select>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-secondary btn-small" onclick="addQuizQuestion()">Add Another Question</button>
                            </div>
                        </div>
                        
                        <!-- Assignment Module Fields -->
                        <div id="assignmentFields" class="hidden">
                            <div class="form-group">
                                <label>Assignment Prompt</label>
                                <textarea id="newModulePrompt" rows="4" placeholder="Enter the assignment instructions and requirements"></textarea>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn">Create Module</button>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function closeAddModuleModal() {
            const modal = document.getElementById('addModuleModal');
            if (modal) {
                modal.remove();
            }
        }

        function toggleModuleFields() {
            const type = document.getElementById('newModuleType').value;
            const contentFields = document.getElementById('contentFields');
            const quizFields = document.getElementById('quizFields');
            const assignmentFields = document.getElementById('assignmentFields');
            
            // Hide all fields first
            contentFields.classList.add('hidden');
            quizFields.classList.add('hidden');
            assignmentFields.classList.add('hidden');
            
            // Show relevant fields
            if (type === 'content') {
                contentFields.classList.remove('hidden');
            } else if (type === 'quiz') {
                quizFields.classList.remove('hidden');
            } else if (type === 'assignment') {
                assignmentFields.classList.remove('hidden');
            }
        }

        function addQuizQuestion() {
            const questionsContainer = document.getElementById('quizQuestions');
            const questionCount = questionsContainer.children.length + 1;
            
            const questionDiv = document.createElement('div');
            questionDiv.className = 'quiz-question';
            questionDiv.style.cssText = 'background: #f7fafc; padding: 15px; border-radius: 8px; margin-bottom: 15px;';
            
            questionDiv.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <strong>Question ${questionCount}</strong>
                    <button type="button" class="btn btn-danger btn-small" onclick="removeQuizQuestion(this)">Remove</button>
                </div>
                <input type="text" placeholder="Question ${questionCount}" class="question-input" style="width: 100%; margin-bottom: 10px;">
                <input type="text" placeholder="Option A" class="option-input" style="width: 100%; margin-bottom: 5px;">
                <input type="text" placeholder="Option B" class="option-input" style="width: 100%; margin-bottom: 5px;">
                <input type="text" placeholder="Option C" class="option-input" style="width: 100%; margin-bottom: 5px;">
                <input type="text" placeholder="Option D" class="option-input" style="width: 100%; margin-bottom: 10px;">
                <select class="correct-answer" style="width: 100%;">
                    <option value="0">Correct Answer: A</option>
                    <option value="1">Correct Answer: B</option>
                    <option value="2">Correct Answer: C</option>
                    <option value="3">Correct Answer: D</option>
                </select>
            `;
            
            questionsContainer.appendChild(questionDiv);
        }

        function removeQuizQuestion(button) {
            button.closest('.quiz-question').remove();
            
            // Renumber remaining questions
            const questions = document.querySelectorAll('.quiz-question');
            questions.forEach((question, index) => {
                const questionNumber = index + 1;
                question.querySelector('strong').textContent = `Question ${questionNumber}`;
                question.querySelector('.question-input').placeholder = `Question ${questionNumber}`;
            });
        }

        function createNewModule(event, courseId) {
            event.preventDefault();
            
            const title = document.getElementById('newModuleTitle').value;
            const type = document.getElementById('newModuleType').value;
            const description = document.getElementById('newModuleDescription').value;
            const duration = parseInt(document.getElementById('newModuleDuration').value);
            
            const newModule = {
                id: 'module_' + Date.now(),
                title,
                description,
                type,
                duration,
                completed: false
            };
            
            // Add type-specific content
            if (type === 'content') {
                newModule.content = document.getElementById('newModuleContent').value;
            } else if (type === 'quiz') {
                const questions = [];
                const questionElements = document.querySelectorAll('.quiz-question');
                
                questionElements.forEach(questionEl => {
                    const questionText = questionEl.querySelector('.question-input').value;
                    const options = Array.from(questionEl.querySelectorAll('.option-input')).map(input => input.value);
                    const correct = parseInt(questionEl.querySelector('.correct-answer').value);
                    
                    if (questionText && options.every(opt => opt.trim())) {
                        questions.push({
                            question: questionText,
                            options: options,
                            correct: correct
                        });
                    }
                });
                
                newModule.questions = questions;
            } else if (type === 'assignment') {
                newModule.prompt = document.getElementById('newModulePrompt').value;
            }
            
            // Add module to course
            const courses = JSON.parse(localStorage.getItem('gwc_courses')) || [];
            const courseIndex = courses.findIndex(c => c.id === courseId);
            
            if (courseIndex !== -1) {
                if (!courses[courseIndex].modules) {
                    courses[courseIndex].modules = [];
                }
                courses[courseIndex].modules.push(newModule);
                courses[courseIndex].lastModified = new Date().toISOString();
                
                localStorage.setItem('gwc_courses', JSON.stringify(courses));
                
                closeAddModuleModal();
                showNotification('Module added successfully!', 'success');
                
                // Refresh the edit course modal
                closeEditCourseModal();
                setTimeout(() => {
                    const updatedCourse = courses[courseIndex];
                    openEditCourseModal(updatedCourse);
                }, 100);
            }
        }

        function editModule(courseId, moduleIndex) {
            const courses = JSON.parse(localStorage.getItem('gwc_courses')) || [];
            const course = courses.find(c => c.id === courseId);
            const module = course.modules[moduleIndex];
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'editModuleModal';
            modal.style.display = 'block';
            
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>✏️ Edit Module: ${module.title}</h2>
                        <button class="close-btn" onclick="closeEditModuleModal()">&times;</button>
                    </div>
                    <form onsubmit="updateModule(event, '${courseId}', ${moduleIndex})">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Module Title</label>
                                <input type="text" id="editModuleTitle" value="${module.title}" required>
                            </div>
                            <div class="form-group">
                                <label>Duration (minutes)</label>
                                <input type="number" id="editModuleDuration" value="${module.duration}" min="1" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Module Description</label>
                            <textarea id="editModuleDescription" rows="2" required>${module.description}</textarea>
                        </div>
                        
                        ${module.type === 'content' ? `
                            <div class="form-group">
                                <label>Content</label>
                                <textarea id="editModuleContent" rows="6">${module.content || ''}</textarea>
                            </div>
                        ` : ''}
                        
                        ${module.type === 'quiz' ? `
                            <div class="form-group">
                                <label>Quiz Questions</label>
                                <div id="editQuizQuestions">
                                    ${(module.questions || []).map((q, qIndex) => `
                                        <div class="quiz-question" style="background: #f7fafc; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                                <strong>Question ${qIndex + 1}</strong>
                                                <button type="button" class="btn btn-danger btn-small" onclick="removeQuizQuestion(this)">Remove</button>
                                            </div>
                                            <input type="text" value="${q.question}" class="question-input" style="width: 100%; margin-bottom: 10px;">
                                            <input type="text" value="${q.options[0]}" class="option-input" style="width: 100%; margin-bottom: 5px;">
                                            <input type="text" value="${q.options[1]}" class="option-input" style="width: 100%; margin-bottom: 5px;">
                                            <input type="text" value="${q.options[2]}" class="option-input" style="width: 100%; margin-bottom: 5px;">
                                            <input type="text" value="${q.options[3]}" class="option-input" style="width: 100%; margin-bottom: 10px;">
                                            <select class="correct-answer" style="width: 100%;">
                                                <option value="0" ${q.correct === 0 ? 'selected' : ''}>Correct Answer: A</option>
                                                <option value="1" ${q.correct === 1 ? 'selected' : ''}>Correct Answer: B</option>
                                                <option value="2" ${q.correct === 2 ? 'selected' : ''}>Correct Answer: C</option>
                                                <option value="3" ${q.correct === 3 ? 'selected' : ''}>Correct Answer: D</option>
                                            </select>
                                        </div>
                                    `).join('')}
                                </div>
                                <button type="button" class="btn btn-secondary btn-small" onclick="addQuizQuestion()">Add Another Question</button>
                            </div>
                        ` : ''}
                        
                        ${module.type === 'assignment' ? `
                            <div class="form-group">
                                <label>Assignment Prompt</label>
                                <textarea id="editModulePrompt" rows="4">${module.prompt || ''}</textarea>
                            </div>
                        ` : ''}
                        
                        <button type="submit" class="btn">Update Module</button>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function closeEditModuleModal() {
            const modal = document.getElementById('editModuleModal');
            if (modal) {
                modal.remove();
            }
        }

        function updateModule(event, courseId, moduleIndex) {
            event.preventDefault();
            
            const title = document.getElementById('editModuleTitle').value;
            const description = document.getElementById('editModuleDescription').value;
            const duration = parseInt(document.getElementById('editModuleDuration').value);
            
            const courses = JSON.parse(localStorage.getItem('gwc_courses')) || [];
            const courseIndex = courses.findIndex(c => c.id === courseId);
            
            if (courseIndex !== -1) {
                const module = courses[courseIndex].modules[moduleIndex];
                
                module.title = title;
                module.description = description;
                module.duration = duration;
                
                // Update type-specific content
                if (module.type === 'content') {
                    module.content = document.getElementById('editModuleContent').value;
                } else if (module.type === 'quiz') {
                    const questions = [];
                    const questionElements = document.querySelectorAll('.quiz-question');
                    
                    questionElements.forEach(questionEl => {
                        const questionText = questionEl.querySelector('.question-input').value;
                        const options = Array.from(questionEl.querySelectorAll('.option-input')).map(input => input.value);
                        const correct = parseInt(questionEl.querySelector('.correct-answer').value);
                        
                        if (questionText && options.every(opt => opt.trim())) {
                            questions.push({
                                question: questionText,
                                options: options,
                                correct: correct
                            });
                        }
                    });
                    
                    module.questions = questions;
                } else if (module.type === 'assignment') {
                    module.prompt = document.getElementById('editModulePrompt').value;
                }
                
                courses[courseIndex].lastModified = new Date().toISOString();
                localStorage.setItem('gwc_courses', JSON.stringify(courses));
                
                closeEditModuleModal();
                showNotification('Module updated successfully!', 'success');
                
                // Refresh the edit course modal
                closeEditCourseModal();
                setTimeout(() => {
                    const updatedCourse = courses[courseIndex];
                    openEditCourseModal(updatedCourse);
                }, 100);
            }
        }

        function deleteModule(courseId, moduleIndex) {
            if (confirm('Are you sure you want to delete this module? This action cannot be undone.')) {
                const courses = JSON.parse(localStorage.getItem('gwc_courses')) || [];
                const courseIndex = courses.findIndex(c => c.id === courseId);
                
                if (courseIndex !== -1) {
                    courses[courseIndex].modules.splice(moduleIndex, 1);
                    courses[courseIndex].lastModified = new Date().toISOString();
                    
                    localStorage.setItem('gwc_courses', JSON.stringify(courses));
                    
                    showNotification('Module deleted successfully!', 'success');
                    
                    // Refresh the edit course modal
                    closeEditCourseModal();
                    setTimeout(() => {
                        const updatedCourse = courses[courseIndex];
                        openEditCourseModal(updatedCourse);
                    }, 100);
                }
            }
        }

        function deleteCourse(courseId) {
            if (confirm('Are you sure you want to delete this course? This action cannot be undone.')) {
                const courses = JSON.parse(localStorage.getItem('gwc_courses')) || [];
                const filteredCourses = courses.filter(c => c.id !== courseId);
                
                localStorage.setItem('gwc_courses', JSON.stringify(filteredCourses));
                loadAdminCourses();
                loadDashboardData();
                showNotification('Course deleted successfully!', 'success');
            }
        }

        // Export and report functions
        function exportLearnerData() {
            const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
            const learners = users.filter(u => u.role === 'intern');
            
            const exportData = learners.map(learner => ({
                name: learner.name,
                email: learner.email,
                department: learner.department,
                registeredDate: learner.registeredDate,
                lastActive: learner.lastActive,
                progress: learner.progress?.overallProgress || 0,
                completedComponents: learner.progress?.completedComponents?.length || 0,
                certificates: learner.progress?.certificates?.length || 0
            }));
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'learner_data_export.json';
            link.click();
            
            showNotification('Learner data exported successfully!', 'success');
        }

        function exportAllReports() {
            const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
            const courses = JSON.parse(localStorage.getItem('gwc_courses')) || [];
            const learners = users.filter(u => u.role === 'intern');
            
            const reportData = {
                generatedDate: new Date().toISOString(),
                summary: {
                    totalLearners: learners.length,
                    totalCourses: courses.length,
                    averageProgress: learners.length > 0 ? Math.round(learners.reduce((sum, l) => sum + (l.progress?.overallProgress || 0), 0) / learners.length) : 0,
                    totalCertificates: learners.reduce((sum, l) => sum + (l.progress?.certificates?.length || 0), 0)
                },
                courses: courses,
                learners: learners.map(learner => ({
                    id: learner.id,
                    name: learner.name,
                    email: learner.email,
                    department: learner.department,
                    registeredDate: learner.registeredDate,
                    lastActive: learner.lastActive,
                    progress: learner.progress
                }))
            };
            
            const dataStr = JSON.stringify(reportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'gwc_complete_report.json';
            link.click();
            
            showNotification('Complete report exported successfully!', 'success');
        }

        function generateProgressReport() {
            const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
            const learners = users.filter(u => u.role === 'intern');
            
            let report = 'Progress Report\n';
            report += '================\n\n';
            report += `Generated: ${new Date().toLocaleDateString()}\n\n`;
            
            learners.forEach(learner => {
                const progress = learner.progress?.overallProgress || 0;
                const completed = learner.progress?.completedComponents?.length || 0;
                report += `${learner.name} (${learner.department || 'N/A'}): ${progress}% - ${completed} components\n`;
            });
            
            const dataBlob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'progress_report.txt';
            link.click();
            
            showNotification('Progress report generated!', 'success');
        }

        function generateEngagementReport() {
            const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
            const courses = JSON.parse(localStorage.getItem('gwc_courses')) || [];
            const learners = users.filter(u => u.role === 'intern');
            
            let report = 'Engagement Report\n';
            report += '==================\n\n';
            report += `Generated: ${new Date().toLocaleDateString()}\n\n`;
            
            report += 'SUMMARY:\n';
            report += `Total Learners: ${learners.length}\n`;
            report += `Total Courses: ${courses.length}\n`;
            report += `Active Learners (this week): ${Math.floor(learners.length * 0.7)}\n\n`;
            
            report += 'LEARNER ENGAGEMENT:\n';
            report += '-------------------\n';
            
            learners.forEach(learner => {
                const progress = learner.progress || {};
                const quizCount = Object.keys(progress.quizScores || {}).length;
                const assignmentCount = Object.keys(progress.assignments || {}).length;
                const lastActive = learner.lastActive ? new Date(learner.lastActive).toLocaleDateString() : 'Never';
                
                report += `${learner.name} (${learner.department || 'N/A'}):\n`;
                report += `  - Overall Progress: ${progress.overallProgress || 0}%\n`;
                report += `  - Quizzes Completed: ${quizCount}\n`;
                report += `  - Assignments Submitted: ${assignmentCount}\n`;
                report += `  - Last Active: ${lastActive}\n\n`;
            });
            
            report += 'COURSE ENGAGEMENT:\n';
            report += '------------------\n';
            
            courses.forEach(course => {
                const enrolledLearners = learners.length;
                const activeLearners = learners.filter(l => l.progress?.moduleProgress?.[course.id] > 0).length;
                const completedLearners = learners.filter(l => l.progress?.moduleProgress?.[course.id] === 100).length;
                
                report += `${course.title}:\n`;
                report += `  - Enrolled: ${enrolledLearners}\n`;
                report += `  - Active: ${activeLearners}\n`;
                report += `  - Completed: ${completedLearners}\n`;
                report += `  - Engagement Rate: ${enrolledLearners > 0 ? Math.round((activeLearners / enrolledLearners) * 100) : 0}%\n\n`;
            });
            
            const dataBlob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'engagement_report.txt';
            link.click();
            
            showNotification('Engagement report generated and downloaded!', 'success');
        }

        function generateCompletionReport() {
            const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
            const courses = JSON.parse(localStorage.getItem('gwc_courses')) || [];
            const learners = users.filter(u => u.role === 'intern');
            
            let report = 'Completion Report\n';
            report += '=================\n\n';
            report += `Generated: ${new Date().toLocaleDateString()}\n\n`;
            
            report += 'OVERALL COMPLETION STATISTICS:\n';
            report += '------------------------------\n';
            
            const totalLearners = learners.length;
            const avgProgress = learners.length > 0 ? Math.round(learners.reduce((sum, l) => sum + (l.progress?.overallProgress || 0), 0) / learners.length) : 0;
            const completedLearners = learners.filter(l => (l.progress?.overallProgress || 0) === 100).length;
            const totalCertificates = learners.reduce((sum, l) => sum + (l.progress?.certificates?.length || 0), 0);
            
            report += `Total Learners: ${totalLearners}\n`;
            report += `Average Progress: ${avgProgress}%\n`;
            report += `Fully Completed: ${completedLearners} (${Math.round((completedLearners / Math.max(totalLearners, 1)) * 100)}%)\n`;
            report += `Certificates Issued: ${totalCertificates}\n\n`;
            
            report += 'COMPLETION BY DEPARTMENT:\n';
            report += '------------------------\n';
            
            const deptStats = {};
            learners.forEach(learner => {
                const dept = learner.department || 'N/A';
                if (!deptStats[dept]) {
                    deptStats[dept] = { total: 0, avgProgress: 0, completed: 0 };
                }
                deptStats[dept].total++;
                deptStats[dept].avgProgress += learner.progress?.overallProgress || 0;
                if ((learner.progress?.overallProgress || 0) === 100) {
                    deptStats[dept].completed++;
                }
            });
            
            Object.keys(deptStats).forEach(dept => {
                const stats = deptStats[dept];
                stats.avgProgress = Math.round(stats.avgProgress / stats.total);
                
                report += `${dept}:\n`;
                report += `  - Total Learners: ${stats.total}\n`;
                report += `  - Average Progress: ${stats.avgProgress}%\n`;
                report += `  - Completed: ${stats.completed} (${Math.round((stats.completed / stats.total) * 100)}%)\n\n`;
            });
            
            report += 'COURSE COMPLETION DETAILS:\n';
            report += '--------------------------\n';
            
            courses.forEach(course => {
                const courseStats = {
                    enrolled: learners.length,
                    started: learners.filter(l => l.progress?.moduleProgress?.[course.id] > 0).length,
                    completed: learners.filter(l => l.progress?.moduleProgress?.[course.id] === 100).length
                };
                
                report += `${course.title}:\n`;
                report += `  - Enrolled: ${courseStats.enrolled}\n`;
                report += `  - Started: ${courseStats.started} (${Math.round((courseStats.started / Math.max(courseStats.enrolled, 1)) * 100)}%)\n`;
                report += `  - Completed: ${courseStats.completed} (${Math.round((courseStats.completed / Math.max(courseStats.enrolled, 1)) * 100)}%)\n\n`;
            });
            
            report += 'INDIVIDUAL LEARNER PROGRESS:\n';
            report += '----------------------------\n';
            
            learners.forEach(learner => {
                const progress = learner.progress || {};
                const certificates = progress.certificates?.length || 0;
                
                report += `${learner.name} (${learner.department || 'N/A'}):\n`;
                report += `  - Overall Progress: ${progress.overallProgress || 0}%\n`;
                report += `  - Components Completed: ${progress.completedComponents?.length || 0}\n`;
                report += `  - Certificates Earned: ${certificates}\n`;
                
                courses.forEach(course => {
                    const courseProgress = progress.moduleProgress?.[course.id] || 0;
                    if (courseProgress > 0) {
                        report += `  - ${course.title}: ${courseProgress}%\n`;
                    }
                });
                
                report += '\n';
            });
            
            const dataBlob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'completion_report.txt';
            link.click();
            
            showNotification('Completion report generated and downloaded!', 'success');
        }

        function generateCustomReport() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'customReportModal';
            modal.style.display = 'block';
            
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>📋 Generate Custom Report</h2>
                        <button class="close-btn" onclick="closeCustomReportModal()">&times;</button>
                    </div>
                    <form onsubmit="createCustomReport(event)">
                        <div class="form-group">
                            <label>Report Title</label>
                            <input type="text" id="customReportTitle" required placeholder="Enter report title">
                        </div>
                        <div class="form-group">
                            <label>Report Type</label>
                            <select id="customReportType" required>
                                <option value="">Select report type</option>
                                <option value="learner-summary">Learner Summary</option>
                                <option value="course-analytics">Course Analytics</option>
                                <option value="department-overview">Department Overview</option>
                                <option value="certificate-audit">Certificate Audit</option>
                                <option value="progress-tracking">Progress Tracking</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Date Range</label>
                            <div class="form-row">
                                <div class="form-group">
                                    <input type="date" id="customReportStartDate">
                                </div>
                                <div class="form-group">
                                    <input type="date" id="customReportEndDate">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Filter by Department (Optional)</label>
                            <select id="customReportDepartment">
                                <option value="">All Departments</option>
                                <option value="Information Technology">Information Technology</option>
                                <option value="Human Resources">Human Resources</option>
                                <option value="Finance & Accounting">Finance & Accounting</option>
                                <option value="Marketing & Communications">Marketing & Communications</option>
                                <option value="Operations & Logistics">Operations & Logistics</option>
                                <option value="Sales & Business Development">Sales & Business Development</option>
                                <option value="Customer Service">Customer Service</option>
                                <option value="Research & Development">Research & Development</option>
                                <option value="Quality Assurance">Quality Assurance</option>
                                <option value="Legal & Compliance">Legal & Compliance</option>
                                <option value="Administration">Administration</option>
                                <option value="Project Management">Project Management</option>
                                <option value="Training & Development">Training & Development</option>
                                <option value="Procurement">Procurement</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Include Data</label>
                            <div style="display: flex; flex-wrap: wrap; gap: 15px; margin-top: 10px;">
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="checkbox" id="includeProgress" checked style="margin-right: 8px;">
                                    Progress Data
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="checkbox" id="includeQuizzes" checked style="margin-right: 8px;">
                                    Quiz Scores
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="checkbox" id="includeAssignments" checked style="margin-right: 8px;">
                                    Assignments
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="checkbox" id="includeCertificates" checked style="margin-right: 8px;">
                                    Certificates
                                </label>
                            </div>
                        </div>
                        <button type="submit" class="btn">Generate Custom Report</button>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function closeCustomReportModal() {
            const modal = document.getElementById('customReportModal');
            if (modal) {
                modal.remove();
            }
        }

        function createCustomReport(event) {
            event.preventDefault();
            
            const title = document.getElementById('customReportTitle').value;
            const type = document.getElementById('customReportType').value;
            const startDate = document.getElementById('customReportStartDate').value;
            const endDate = document.getElementById('customReportEndDate').value;
            const department = document.getElementById('customReportDepartment').value;
            
            const includeProgress = document.getElementById('includeProgress').checked;
            const includeQuizzes = document.getElementById('includeQuizzes').checked;
            const includeAssignments = document.getElementById('includeAssignments').checked;
            const includeCertificates = document.getElementById('includeCertificates').checked;
            
            const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
            const courses = JSON.parse(localStorage.getItem('gwc_courses')) || [];
            let learners = users.filter(u => u.role === 'intern');
            
            // Filter by department if specified
            if (department) {
                learners = learners.filter(l => l.department === department);
            }
            
            let report = `${title}\n`;
            report += '='.repeat(title.length) + '\n\n';
            report += `Generated: ${new Date().toLocaleDateString()}\n`;
            report += `Report Type: ${type}\n`;
            if (startDate) report += `Start Date: ${startDate}\n`;
            if (endDate) report += `End Date: ${endDate}\n`;
            if (department) report += `Department Filter: ${department}\n`;
            report += '\n';
            
            switch (type) {
                case 'learner-summary':
                    report += 'LEARNER SUMMARY:\n';
                    report += '----------------\n\n';
                    learners.forEach(learner => {
                        report += `${learner.name} (${learner.email}):\n`;
                        report += `  Department: ${learner.department || 'N/A'}\n`;
                        report += `  Registered: ${new Date(learner.registeredDate).toLocaleDateString()}\n`;
                        report += `  Last Active: ${new Date(learner.lastActive).toLocaleDateString()}\n`;
                        
                        if (includeProgress) {
                            report += `  Overall Progress: ${learner.progress?.overallProgress || 0}%\n`;
                        }
                        if (includeQuizzes) {
                            report += `  Quizzes Completed: ${Object.keys(learner.progress?.quizScores || {}).length}\n`;
                        }
                        if (includeAssignments) {
                            report += `  Assignments Submitted: ${Object.keys(learner.progress?.assignments || {}).length}\n`;
                        }
                        if (includeCertificates) {
                            report += `  Certificates Earned: ${learner.progress?.certificates?.length || 0}\n`;
                        }
                        report += '\n';
                    });
                    break;
                    
                case 'course-analytics':
                    report += 'COURSE ANALYTICS:\n';
                    report += '-----------------\n\n';
                    courses.forEach(course => {
                        const enrolled = learners.length;
                        const started = learners.filter(l => l.progress?.moduleProgress?.[course.id] > 0).length;
                        const completed = learners.filter(l => l.progress?.moduleProgress?.[course.id] === 100).length;
                        
                        report += `${course.title}:\n`;
                        report += `  Description: ${course.description}\n`;
                        report += `  Duration: ${course.duration || 0} hours\n`;
                        report += `  Category: ${course.category}\n`;
                        report += `  Enrolled Learners: ${enrolled}\n`;
                        report += `  Started: ${started} (${Math.round((started / Math.max(enrolled, 1)) * 100)}%)\n`;
                        report += `  Completed: ${completed} (${Math.round((completed / Math.max(enrolled, 1)) * 100)}%)\n`;
                        report += `  Completion Rate: ${Math.round((completed / Math.max(enrolled, 1)) * 100)}%\n\n`;
                    });
                    break;
                    
                case 'department-overview':
                    report += 'DEPARTMENT OVERVIEW:\n';
                    report += '-------------------\n\n';
                    const deptStats = {};
                    learners.forEach(learner => {
                        const dept = learner.department || 'N/A';
                        if (!deptStats[dept]) {
                            deptStats[dept] = { 
                                total: 0, 
                                avgProgress: 0, 
                                completed: 0,
                                certificates: 0,
                                quizzes: 0,
                                assignments: 0
                            };
                        }
                        deptStats[dept].total++;
                        deptStats[dept].avgProgress += learner.progress?.overallProgress || 0;
                        if ((learner.progress?.overallProgress || 0) === 100) {
                            deptStats[dept].completed++;
                        }
                        deptStats[dept].certificates += learner.progress?.certificates?.length || 0;
                        deptStats[dept].quizzes += Object.keys(learner.progress?.quizScores || {}).length;
                        deptStats[dept].assignments += Object.keys(learner.progress?.assignments || {}).length;
                    });
                    
                    Object.keys(deptStats).forEach(dept => {
                        const stats = deptStats[dept];
                        stats.avgProgress = Math.round(stats.avgProgress / stats.total);
                        
                        report += `${dept}:\n`;
                        report += `  Total Learners: ${stats.total}\n`;
                        report += `  Average Progress: ${stats.avgProgress}%\n`;
                        report += `  Completed Courses: ${stats.completed}\n`;
                        report += `  Total Certificates: ${stats.certificates}\n`;
                        report += `  Total Quizzes: ${stats.quizzes}\n`;
                        report += `  Total Assignments: ${stats.assignments}\n\n`;
                    });
                    break;
                    
                case 'certificate-audit':
                    report += 'CERTIFICATE AUDIT:\n';
                    report += '------------------\n\n';
                    let totalCerts = 0;
                    learners.forEach(learner => {
                        const certificates = learner.progress?.certificates || [];
                        if (certificates.length > 0) {
                            report += `${learner.name} (${learner.department || 'N/A'}):\n`;
                            certificates.forEach(cert => {
                                report += `  - ${cert.courseTitle} (ID: ${cert.id})\n`;
                                report += `    Issued: ${cert.issueDate}\n`;
                                totalCerts++;
                            });
                            report += '\n';
                        }
                    });
                    report += `Total Certificates Issued: ${totalCerts}\n`;
                    break;
                    
                case 'progress-tracking':
                    report += 'PROGRESS TRACKING:\n';
                    report += '------------------\n\n';
                    learners.forEach(learner => {
                        report += `${learner.name}:\n`;
                        courses.forEach(course => {
                            const courseProgress = learner.progress?.moduleProgress?.[course.id] || 0;
                            report += `  ${course.title}: ${courseProgress}%\n`;
                        });
                        report += '\n';
                    });
                    break;
            }
            
            const dataBlob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `${title.replace(/\s+/g, '_')}_${type}_report.txt`;
            link.click();
            
            closeCustomReportModal();
            showNotification('Custom report generated and downloaded!', 'success');
        }

        // Certificate functions
        function generateBulkCertificates() {
            const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
            const courses = JSON.parse(localStorage.getItem('gwc_courses')) || [];
            const learners = users.filter(u => u.role === 'intern');
            
            if (learners.length === 0) {
                showNotification('No learners found to generate certificates for.', 'error');
                return;
            }
            
            let certificatesGenerated = 0;
            
            learners.forEach(learner => {
                courses.forEach(course => {
                    const courseProgress = learner.progress?.moduleProgress?.[course.id] || 0;
                    
                    if (courseProgress === 100) {
                        // Check if certificate already exists
                        const existingCert = learner.progress?.certificates?.find(c => c.courseId === course.id);
                        
                        if (!existingCert) {
                            const certificate = {
                                id: 'cert_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                                courseId: course.id,
                                courseTitle: course.title,
                                learnerName: learner.name,
                                learnerId: learner.id,
                                issueDate: new Date().toLocaleDateString(),
                                issueDateISO: new Date().toISOString()
                            };
                            
                            if (!learner.progress.certificates) {
                                learner.progress.certificates = [];
                            }
                            
                            learner.progress.certificates.push(certificate);
                            certificatesGenerated++;
                        }
                    }
                });
            });
            
            // Update users in localStorage
            const allUsers = JSON.parse(localStorage.getItem('gwc_users')) || [];
            learners.forEach(learner => {
                const userIndex = allUsers.findIndex(u => u.id === learner.id);
                if (userIndex !== -1) {
                    allUsers[userIndex] = learner;
                }
            });
            
            localStorage.setItem('gwc_users', JSON.stringify(allUsers));
            
            showNotification(`Bulk certificate generation completed! ${certificatesGenerated} certificates generated.`, 'success');
            loadCertificatesList();
            loadDashboardData();
        }

        function customizeCertificateTemplate() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'certificateTemplateModal';
            modal.style.display = 'block';
            
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <h2>🎨 Customize Certificate Template</h2>
                        <button class="close-btn" onclick="closeCertificateTemplateModal()">&times;</button>
                    </div>
                    <div style="display: flex; gap: 20px;">
                        <div style="flex: 1;">
                            <h3>Template Settings</h3>
                            <div class="form-group">
                                <label>Certificate Title</label>
                                <input type="text" id="certTitle" value="Certificate of Completion" placeholder="Enter certificate title">
                            </div>
                            <div class="form-group">
                                <label>Organization Name</label>
                                <input type="text" id="certOrg" value="Graduate World Connect" placeholder="Enter organization name">
                            </div>
                            <div class="form-group">
                                <label>Background Color</label>
                                <select id="certBgColor">
                                    <option value="#1a4d3a">Dark Green (Default)</option>
                                    <option value="#2563eb">Blue</option>
                                    <option value="#7c3aed">Purple</option>
                                    <option value="#dc2626">Red</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Border Color</label>
                                <select id="certBorderColor">
                                    <option value="#ffd700">Gold (Default)</option>
                                    <option value="#ffffff">White</option>
                                    <option value="#e5e7eb">Silver</option>
                                </select>
                            </div>
                            <button class="btn" onclick="updateCertificateTemplate()">Update Template</button>
                        </div>
                        <div style="flex: 1;">
                            <h3>Preview</h3>
                            <div id="certificatePreview" class="certificate-preview" style="transform: scale(0.7); transform-origin: top left;">
                                <div class="certificate-content">
                                    <div class="certificate-border">
                                        <h1 style="margin-bottom: 20px; font-size: 32px;">🏆 Certificate of Completion</h1>
                                        <p style="font-size: 18px; margin-bottom: 20px;">This is to certify that</p>
                                        <h2 style="margin-bottom: 20px; font-size: 28px; color: #ffd700;">Sample Student Name</h2>
                                        <p style="font-size: 18px; margin-bottom: 20px;">has successfully completed the</p>
                                        <h3 style="margin-bottom: 30px; font-size: 24px;">Sample Course Title</h3>
                                        <div style="display: flex; justify-content: space-between; margin-top: 40px;">
                                            <div>
                                                <p style="border-top: 2px solid #ffd700; padding-top: 10px;">Date: ${new Date().toLocaleDateString()}</p>
                                            </div>
                                            <div>
                                                <p style="border-top: 2px solid #ffd700; padding-top: 10px;">Graduate World Connect</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function closeCertificateTemplateModal() {
            const modal = document.getElementById('certificateTemplateModal');
            if (modal) {
                modal.remove();
            }
        }

        function updateCertificateTemplate() {
            const title = document.getElementById('certTitle').value;
            const org = document.getElementById('certOrg').value;
            const bgColor = document.getElementById('certBgColor').value;
            const borderColor = document.getElementById('certBorderColor').value;
            
            // Save template settings
            const templateSettings = {
                title,
                organization: org,
                backgroundColor: bgColor,
                borderColor: borderColor
            };
            
            localStorage.setItem('gwc_certificate_template', JSON.stringify(templateSettings));
            
            showNotification('Certificate template updated successfully!', 'success');
            closeCertificateTemplateModal();
        }

        function exportCertificateData() {
            const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
            const learners = users.filter(u => u.role === 'intern');
            
            const certificateData = [];
            
            learners.forEach(learner => {
                const certificates = learner.progress?.certificates || [];
                certificates.forEach(cert => {
                    certificateData.push({
                        certificateId: cert.id,
                        learnerName: cert.learnerName,
                        learnerEmail: learner.email,
                        courseTitle: cert.courseTitle,
                        issueDate: cert.issueDate,
                        department: learner.department || 'N/A'
                    });
                });
            });
            
            if (certificateData.length === 0) {
                showNotification('No certificates found to export.', 'error');
                return;
            }
            
            const dataStr = JSON.stringify(certificateData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'certificate_data_export.json';
            link.click();
            
            showNotification(`Certificate data exported! ${certificateData.length} certificates included.`, 'success');
        }

        function verifyCertificates() {
            const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
            const learners = users.filter(u => u.role === 'intern');
            
            let totalCertificates = 0;
            let validCertificates = 0;
            
            learners.forEach(learner => {
                const certificates = learner.progress?.certificates || [];
                totalCertificates += certificates.length;
                
                certificates.forEach(cert => {
                    // Simple verification - check if certificate has required fields
                    if (cert.id && cert.courseId && cert.learnerName && cert.issueDate) {
                        validCertificates++;
                    }
                });
            });
            
            const verificationReport = `Certificate Verification Report:
            
Total Certificates: ${totalCertificates}
Valid Certificates: ${validCertificates}
Invalid Certificates: ${totalCertificates - validCertificates}
Verification Rate: ${totalCertificates > 0 ? Math.round((validCertificates / totalCertificates) * 100) : 0}%

Verification completed on: ${new Date().toLocaleString()}`;
            
            alert(verificationReport);
            showNotification('Certificate verification completed!', 'success');
        }

        function viewCertificate(certId, learnerId) {
            const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
            const learner = users.find(u => u.id === learnerId);
            const certificate = learner?.progress?.certificates?.find(c => c.id === certId);
            
            if (!certificate) {
                showNotification('Certificate not found.', 'error');
                return;
            }
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'viewCertificateModal';
            modal.style.display = 'block';
            
            // Get template settings
            const templateSettings = JSON.parse(localStorage.getItem('gwc_certificate_template')) || {
                title: 'Certificate of Completion',
                organization: 'Graduate World Connect',
                backgroundColor: '#1a4d3a',
                borderColor: '#ffd700'
            };
            
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <h2>🏆 Certificate Viewer</h2>
                        <button class="close-btn" onclick="closeViewCertificateModal()">&times;</button>
                    </div>
                    <div class="certificate-preview" style="background: linear-gradient(135deg, ${templateSettings.backgroundColor} 0%, ${templateSettings.backgroundColor}dd 100%);">
                        <div class="certificate-content">
                            <div class="certificate-border" style="border-color: ${templateSettings.borderColor};">
                                <h1 style="margin-bottom: 20px; font-size: 32px;">🏆 ${templateSettings.title}</h1>
                                <p style="font-size: 18px; margin-bottom: 20px;">This is to certify that</p>
                                <h2 style="margin-bottom: 20px; font-size: 28px; color: ${templateSettings.borderColor};">${certificate.learnerName}</h2>
                                <p style="font-size: 18px; margin-bottom: 20px;">has successfully completed the</p>
                                <h3 style="margin-bottom: 30px; font-size: 24px;">${certificate.courseTitle}</h3>
                                <div style="display: flex; justify-content: space-between; margin-top: 40px;">
                                    <div>
                                        <p style="border-top: 2px solid ${templateSettings.borderColor}; padding-top: 10px;">Date: ${certificate.issueDate}</p>
                                    </div>
                                    <div>
                                        <p style="border-top: 2px solid ${templateSettings.borderColor}; padding-top: 10px;">${templateSettings.organization}</p>
                                    </div>
                                </div>
                                <div style="margin-top: 20px; font-size: 12px; color: #ccc;">
                                    Certificate ID: ${certificate.id}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-warning" onclick="downloadCertificateAdmin('${certId}', '${learnerId}')">
                            📥 Download Certificate
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function closeViewCertificateModal() {
            const modal = document.getElementById('viewCertificateModal');
            if (modal) {
                modal.remove();
            }
        }

        function downloadCertificateAdmin(certId, learnerId) {
            const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
            const learner = users.find(u => u.id === learnerId);
            const certificate = learner?.progress?.certificates?.find(c => c.id === certId);
            
            if (!certificate) {
                showNotification('Certificate not found.', 'error');
                return;
            }
            
            const certificateData = {
                certificateId: certificate.id,
                learnerName: certificate.learnerName,
                learnerEmail: learner.email,
                courseTitle: certificate.courseTitle,
                issueDate: certificate.issueDate,
                organization: 'Graduate World Connect',
                downloadDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(certificateData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `Certificate_${certificate.learnerName.replace(/\s+/g, '_')}_${certificate.courseTitle.replace(/\s+/g, '_')}.json`;
            link.click();
            
            showNotification('Certificate downloaded successfully!', 'success');
        }

        function verifyCertificate(certId) {
            const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
            let certificateFound = false;
            let certificateDetails = null;
            
            users.forEach(user => {
                const certificates = user.progress?.certificates || [];
                const cert = certificates.find(c => c.id === certId);
                if (cert) {
                    certificateFound = true;
                    certificateDetails = {
                        ...cert,
                        learnerEmail: user.email,
                        department: user.department
                    };
                }
            });
            
            if (certificateFound) {
                alert(`Certificate Verification Result:

✅ VALID CERTIFICATE

Certificate ID: ${certificateDetails.id}
Learner: ${certificateDetails.learnerName}
Email: ${certificateDetails.learnerEmail}
Course: ${certificateDetails.courseTitle}
Issue Date: ${certificateDetails.issueDate}
Department: ${certificateDetails.department || 'N/A'}

This certificate is authentic and verified.`);
                
                showNotification('Certificate verified successfully! ✅', 'success');
            } else {
                alert(`Certificate Verification Result:

❌ INVALID CERTIFICATE

Certificate ID: ${certId}

This certificate could not be found in our records. It may be fraudulent or the ID may be incorrect.`);
                
                showNotification('Certificate verification failed! ❌', 'error');
            }
        }

        // Other admin functions
        function duplicateCourse() {
            const courses = JSON.parse(localStorage.getItem('gwc_courses')) || [];
            if (courses.length === 0) {
                showNotification('No courses available to duplicate.', 'error');
                return;
            }
            
            const courseTitle = prompt('Enter the title of the course to duplicate:');
            if (!courseTitle) return;
            
            const courseToClone = courses.find(c => c.title.toLowerCase().includes(courseTitle.toLowerCase()));
            if (!courseToClone) {
                showNotification('Course not found. Please check the title and try again.', 'error');
                return;
            }
            
            const newTitle = prompt('Enter title for the duplicated course:', courseToClone.title + ' (Copy)');
            if (!newTitle) return;
            
            const duplicatedCourse = {
                ...courseToClone,
                id: 'course-' + Date.now(),
                title: newTitle,
                createdBy: currentUser.id,
                createdDate: new Date().toISOString(),
                modules: courseToClone.modules ? courseToClone.modules.map(m => ({...m, completed: false})) : []
            };
            
            courses.push(duplicatedCourse);
            localStorage.setItem('gwc_courses', JSON.stringify(courses));
            
            showNotification(`Course "${newTitle}" duplicated successfully!`, 'success');
            loadAdminCourses();
            loadDashboardData();
        }

        function exportCourseTemplates() {
            const courses = JSON.parse(localStorage.getItem('gwc_courses')) || [];
            
            const templates = courses.map(course => ({
                title: course.title,
                description: course.description,
                icon: course.icon,
                category: course.category,
                duration: course.duration,
                modules: course.modules ? course.modules.map(m => ({
                    title: m.title,
                    description: m.description,
                    type: m.type,
                    content: m.content,
                    duration: m.duration,
                    questions: m.questions,
                    prompt: m.prompt
                })) : []
            }));
            
            const dataStr = JSON.stringify(templates, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'course_templates.json';
            link.click();
            
            showNotification('Course templates exported successfully!', 'success');
        }

        function sendBulkNotifications() {
            const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
            const learners = users.filter(u => u.role === 'intern');
            
            if (learners.length === 0) {
                showNotification('No learners found to send notifications to.', 'error');
                return;
            }
            
            const message = prompt('Enter notification message for all learners:');
            if (!message) return;
            
            // Simulate sending notifications
            const notification = {
                id: 'notif_' + Date.now(),
                message: message,
                sentDate: new Date().toISOString(),
                sentBy: currentUser.name
            };
            
            learners.forEach(learner => {
                if (!learner.notifications) {
                    learner.notifications = [];
                }
                learner.notifications.push(notification);
            });
            
            // Update users in localStorage
            const allUsers = JSON.parse(localStorage.getItem('gwc_users')) || [];
            learners.forEach(learner => {
                const userIndex = allUsers.findIndex(u => u.id === learner.id);
                if (userIndex !== -1) {
                    allUsers[userIndex] = learner;
                }
            });
            
            localStorage.setItem('gwc_users', JSON.stringify(allUsers));
            
            showNotification(`Bulk notification sent to ${learners.length} learners!`, 'success');
        }

        function viewSystemSettings() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'systemSettingsModal';
            modal.style.display = 'block';
            
            const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
            const courses = JSON.parse(localStorage.getItem('gwc_courses')) || [];
            const totalStorage = JSON.stringify({users, courses}).length;
            
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>⚙️ System Settings</h2>
                        <button class="close-btn" onclick="closeSystemSettingsModal()">&times;</button>
                    </div>
                    <div class="dashboard-grid">
                        <div class="dashboard-card">
                            <h3>📊 System Statistics</h3>
                            <p><strong>Total Users:</strong> ${users.length}</p>
                            <p><strong>Total Courses:</strong> ${courses.length}</p>
                            <p><strong>Data Size:</strong> ${(totalStorage / 1024).toFixed(2)} KB</p>
                            <p><strong>System Version:</strong> GWConnect LMS v1.0</p>
                        </div>
                        <div class="dashboard-card">
                            <h3>🔧 System Actions</h3>
                            <button class="btn btn-warning btn-small" onclick="backupSystemData()" style="margin: 5px; width: auto;">
                                💾 Backup Data
                            </button>
                            <button class="btn btn-secondary btn-small" onclick="clearSystemCache()" style="margin: 5px; width: auto;">
                                🗑️ Clear Cache
                            </button>
                            <button class="btn btn-danger btn-small" onclick="resetSystemData()" style="margin: 5px; width: auto;">
                                ⚠️ Reset System
                            </button>
                        </div>
                        <div class="dashboard-card">
                            <h3>📈 Performance Metrics</h3>
                            <p><strong>Active Sessions:</strong> 1</p>
                            <p><strong>Last Backup:</strong> Never</p>
                            <p><strong>System Uptime:</strong> ${Math.floor(Math.random() * 24)} hours</p>
                            <p><strong>Memory Usage:</strong> ${Math.floor(Math.random() * 50 + 30)}%</p>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function closeSystemSettingsModal() {
            const modal = document.getElementById('systemSettingsModal');
            if (modal) {
                modal.remove();
            }
        }

        function backupSystemData() {
            const users = JSON.parse(localStorage.getItem('gwc_users')) || [];
            const courses = JSON.parse(localStorage.getItem('gwc_courses')) || [];
            
            const backupData = {
                timestamp: new Date().toISOString(),
                version: '1.0',
                users: users,
                courses: courses
            };
            
            const dataStr = JSON.stringify(backupData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `gwc_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('System data backed up successfully!', 'success');
        }

        function clearSystemCache() {
            // Clear any cached data (in a real system, this would clear actual cache)
            showNotification('System cache cleared successfully!', 'success');
        }

        function resetSystemData() {
            if (confirm('⚠️ WARNING: This will delete ALL data including users, courses, and progress. This action cannot be undone. Are you sure?')) {
                if (confirm('This is your final warning. All data will be permanently lost. Continue?')) {
                    localStorage.removeItem('gwc_users');
                    localStorage.removeItem('gwc_courses');
                    localStorage.removeItem('gwc_current_user');
                    
                    showNotification('System reset completed. Redirecting to login...', 'info');
                    
                    setTimeout(() => {
                        location.reload();
                    }, 2000);
                }
            }
        }

        function downloadLogbook() {
            if (!currentUser) return;
            
            const courses = JSON.parse(localStorage.getItem('gwc_courses')) || [];
            const progress = currentUser.progress || {};
            const logbookEvidence = progress.logbookEvidence || [];
            
            // Create comprehensive logbook content
            let logbookContent = `
GRADUATE WORLD CONNECT
LEARNING MANAGEMENT SYSTEM
LOGBOOK EVIDENCE REPORT

=====================================

LEARNER INFORMATION:
Name: ${currentUser.name}
Email: ${currentUser.email}
Department: ${currentUser.department || 'N/A'}
Registration Date: ${new Date(currentUser.registeredDate).toLocaleDateString()}
Report Generated: ${new Date().toLocaleDateString()}

=====================================

OVERALL PROGRESS SUMMARY:
Overall Completion: ${progress.overallProgress || 0}%
Total Components Completed: ${progress.completedComponents?.length || 0}
Total Quizzes Taken: ${Object.keys(progress.quizScores || {}).length}
Total Assignments Submitted: ${Object.keys(progress.assignments || {}).length}
Certificates Earned: ${progress.certificates?.length || 0}

=====================================

COURSE PROGRESS DETAILS:
`;

            // Add course-specific progress
            courses.forEach(course => {
                const courseProgress = progress.moduleProgress?.[course.id] || 0;
                logbookContent += `
${course.title}:
  Progress: ${courseProgress}%
  Status: ${courseProgress === 100 ? 'COMPLETED' : courseProgress > 0 ? 'IN PROGRESS' : 'NOT STARTED'}
`;
                
                if (course.modules && courseProgress > 0) {
                    logbookContent += `  Modules:\n`;
                    course.modules.forEach((module, index) => {
                        const status = module.completed ? '✓ COMPLETED' : '○ PENDING';
                        logbookContent += `    ${index + 1}. ${module.title} - ${status}\n`;
                    });
                }
                logbookContent += '\n';
            });

            // Add detailed evidence log
            logbookContent += `
=====================================

DETAILED LEARNING EVIDENCE:
`;

            if (logbookEvidence.length > 0) {
                logbookEvidence.forEach((evidence, index) => {
                    logbookContent += `
${index + 1}. ${evidence.description}
   Course: ${evidence.courseTitle}
   Module: ${evidence.moduleTitle}
   Type: ${evidence.moduleType.toUpperCase()}
   Completed: ${new Date(evidence.completedDate).toLocaleDateString()}
`;
                });
            } else {
                logbookContent += '\nNo learning evidence recorded yet.\n';
            }

            // Add quiz scores
            if (Object.keys(progress.quizScores || {}).length > 0) {
                logbookContent += `
=====================================

QUIZ PERFORMANCE:
`;
                Object.entries(progress.quizScores || {}).forEach(([key, score]) => {
                    const [courseId, moduleIndex] = key.split('_');
                    const course = courses.find(c => c.id === courseId);
                    const courseName = course ? course.title : 'Unknown Course';
                    logbookContent += `${courseName} - Quiz: ${score}%\n`;
                });
            }

            // Add assignment submissions
            if (Object.keys(progress.assignments || {}).length > 0) {
                logbookContent += `
=====================================

ASSIGNMENT SUBMISSIONS:
`;
                Object.entries(progress.assignments || {}).forEach(([key, assignment]) => {
                    logbookContent += `
${assignment.courseTitle || 'Unknown Course'}
Module: ${assignment.moduleTitle || 'Unknown Module'}
Submitted: ${new Date(assignment.submittedDate).toLocaleDateString()}
Response Length: ${assignment.response ? assignment.response.length : 0} characters
`;
                });
            }

            // Add certificates
            if (progress.certificates && progress.certificates.length > 0) {
                logbookContent += `
=====================================

CERTIFICATES EARNED:
`;
                progress.certificates.forEach((cert, index) => {
                    logbookContent += `
${index + 1}. ${cert.courseTitle}
   Certificate ID: ${cert.id}
   Issue Date: ${cert.issueDate}
   Learner: ${cert.learnerName}
`;
                });
            }

            logbookContent += `
=====================================

VERIFICATION:
This logbook evidence report is automatically generated from the 
Graduate World Connect Learning Management System. All progress 
data is tracked and verified through the system.

Report ID: LOG_${currentUser.id}_${Date.now()}
Generated: ${new Date().toLocaleString()}

=====================================
`;

            // Create and download the file
            const dataBlob = new Blob([logbookContent], { type: 'text/plain' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `${currentUser.name.replace(/\s+/g, '_')}_Logbook_Evidence_${new Date().toISOString().split('T')[0]}.txt`;
            link.click();
            
            // Also create a detailed JSON backup
            const detailedEvidence = {
                learnerInfo: {
                    id: currentUser.id,
                    name: currentUser.name,
                    email: currentUser.email,
                    department: currentUser.department,
                    registeredDate: currentUser.registeredDate,
                    lastActive: currentUser.lastActive
                },
                progressSummary: {
                    overallProgress: progress.overallProgress || 0,
                    completedComponents: progress.completedComponents || [],
                    moduleProgress: progress.moduleProgress || {},
                    totalQuizzes: Object.keys(progress.quizScores || {}).length,
                    totalAssignments: Object.keys(progress.assignments || {}).length,
                    totalCertificates: progress.certificates?.length || 0
                },
                detailedProgress: {
                    quizScores: progress.quizScores || {},
                    assignments: progress.assignments || {},
                    certificates: progress.certificates || [],
                    logbookEvidence: progress.logbookEvidence || []
                },
                courses: courses.map(course => ({
                    id: course.id,
                    title: course.title,
                    progress: progress.moduleProgress?.[course.id] || 0,
                    modules: course.modules ? course.modules.map(m => ({
                        title: m.title,
                        type: m.type,
                        completed: m.completed || false
                    })) : []
                })),
                generatedDate: new Date().toISOString(),
                reportId: `LOG_${currentUser.id}_${Date.now()}`
            };
            
            const jsonBlob = new Blob([JSON.stringify(detailedEvidence, null, 2)], { type: 'application/json' });
            const jsonUrl = URL.createObjectURL(jsonBlob);
            const jsonLink = document.createElement('a');
            jsonLink.href = jsonUrl;
            jsonLink.download = `${currentUser.name.replace(/\s+/g, '_')}_Detailed_Evidence_${new Date().toISOString().split('T')[0]}.json`;
            
            // Download both files
            setTimeout(() => {
                jsonLink.click();
            }, 1000);
            
            showNotification('Logbook evidence downloaded successfully! (Text + JSON formats)', 'success');
        }

        // Utility functions
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            const text = document.getElementById('notificationText');
            
            text.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96e77af9e5e573da',t:'MTc1NTA4MDQzMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
